(()=>{var Kn=Object.create;var je=Object.defineProperty,Yn=Object.defineProperties,Qn=Object.getOwnPropertyDescriptor,qn=Object.getOwnPropertyDescriptors,Jn=Object.getOwnPropertyNames,pr=Object.getOwnPropertySymbols,Zn=Object.getPrototypeOf,br=Object.prototype.hasOwnProperty,jn=Object.prototype.propertyIsEnumerable;var vr=(r,e,n)=>e in r?je(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,oe=(r,e)=>{for(var n in e||(e={}))br.call(e,n)&&vr(r,n,e[n]);if(pr)for(var n of pr(e))jn.call(e,n)&&vr(r,n,e[n]);return r},gr=(r,e)=>Yn(r,qn(e));var Se=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(e,n)=>(typeof require!="undefined"?require:e)[n]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var ea=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var ta=(r,e,n,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let f of Jn(e))!br.call(r,f)&&f!==n&&je(r,f,{get:()=>e[f],enumerable:!(u=Qn(e,f))||u.enumerable});return r};var ra=(r,e,n)=>(n=r!=null?Kn(Zn(r)):{},ta(e||!r||!r.__esModule?je(n,"default",{value:r,enumerable:!0}):n,r));var Mr=ea((Sr,rt)=>{(function(r){if(typeof Sr=="object"&&typeof rt<"u")rt.exports=r();else if(typeof define=="function"&&define.amd)define([],r);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.localforage=r()}})(function(){var r,e,n;return function u(f,E,T){function w(k,V){if(!E[k]){if(!f[k]){var y=typeof Se=="function"&&Se;if(!V&&y)return y(k,!0);if(L)return L(k,!0);var P=new Error("Cannot find module '"+k+"'");throw P.code="MODULE_NOT_FOUND",P}var U=E[k]={exports:{}};f[k][0].call(U.exports,function($){var Q=f[k][1][$];return w(Q||$)},U,U.exports,u,f,E,T)}return E[k].exports}for(var L=typeof Se=="function"&&Se,B=0;B<T.length;B++)w(T[B]);return w}({1:[function(u,f,E){(function(T){"use strict";var w=T.MutationObserver||T.WebKitMutationObserver,L;if(w){var B=0,k=new w($),V=T.document.createTextNode("");k.observe(V,{characterData:!0}),L=function(){V.data=B=++B%2}}else if(!T.setImmediate&&typeof T.MessageChannel<"u"){var y=new T.MessageChannel;y.port1.onmessage=$,L=function(){y.port2.postMessage(0)}}else"document"in T&&"onreadystatechange"in T.document.createElement("script")?L=function(){var G=T.document.createElement("script");G.onreadystatechange=function(){$(),G.onreadystatechange=null,G.parentNode.removeChild(G),G=null},T.document.documentElement.appendChild(G)}:L=function(){setTimeout($,0)};var P,U=[];function $(){P=!0;for(var G,re,X=U.length;X;){for(re=U,U=[],G=-1;++G<X;)re[G]();X=U.length}P=!1}f.exports=Q;function Q(G){U.push(G)===1&&!P&&L()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(u,f,E){"use strict";var T=u(1);function w(){}var L={},B=["REJECTED"],k=["FULFILLED"],V=["PENDING"];f.exports=y;function y(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=V,this.queue=[],this.outcome=void 0,g!==w&&Q(this,g)}y.prototype.catch=function(g){return this.then(null,g)},y.prototype.then=function(g,H){if(typeof g!="function"&&this.state===k||typeof H!="function"&&this.state===B)return this;var A=new this.constructor(w);if(this.state!==V){var N=this.state===k?g:H;U(A,N,this.outcome)}else this.queue.push(new P(A,g,H));return A};function P(g,H,A){this.promise=g,typeof H=="function"&&(this.onFulfilled=H,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}P.prototype.callFulfilled=function(g){L.resolve(this.promise,g)},P.prototype.otherCallFulfilled=function(g){U(this.promise,this.onFulfilled,g)},P.prototype.callRejected=function(g){L.reject(this.promise,g)},P.prototype.otherCallRejected=function(g){U(this.promise,this.onRejected,g)};function U(g,H,A){T(function(){var N;try{N=H(A)}catch(z){return L.reject(g,z)}N===g?L.reject(g,new TypeError("Cannot resolve promise with itself")):L.resolve(g,N)})}L.resolve=function(g,H){var A=G($,H);if(A.status==="error")return L.reject(g,A.value);var N=A.value;if(N)Q(g,N);else{g.state=k,g.outcome=H;for(var z=-1,K=g.queue.length;++z<K;)g.queue[z].callFulfilled(H)}return g},L.reject=function(g,H){g.state=B,g.outcome=H;for(var A=-1,N=g.queue.length;++A<N;)g.queue[A].callRejected(H);return g};function $(g){var H=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof H=="function")return function(){H.apply(g,arguments)}}function Q(g,H){var A=!1;function N(J){A||(A=!0,L.reject(g,J))}function z(J){A||(A=!0,L.resolve(g,J))}function K(){H(z,N)}var q=G(K);q.status==="error"&&N(q.value)}function G(g,H){var A={};try{A.value=g(H),A.status="success"}catch(N){A.status="error",A.value=N}return A}y.resolve=re;function re(g){return g instanceof this?g:L.resolve(new this(w),g)}y.reject=X;function X(g){var H=new this(w);return L.reject(H,g)}y.all=Ge;function Ge(g){var H=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=g.length,N=!1;if(!A)return this.resolve([]);for(var z=new Array(A),K=0,q=-1,J=new this(w);++q<A;)ne(g[q],q);return J;function ne(ye,Ae){H.resolve(ye).then(Xe,function(de){N||(N=!0,L.reject(J,de))});function Xe(de){z[Ae]=de,++K===A&&!N&&(N=!0,L.resolve(J,z))}}}y.race=ue;function ue(g){var H=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=g.length,N=!1;if(!A)return this.resolve([]);for(var z=-1,K=new this(w);++z<A;)q(g[z]);return K;function q(J){H.resolve(J).then(function(ne){N||(N=!0,L.resolve(K,ne))},function(ne){N||(N=!0,L.reject(K,ne))})}}},{"1":1}],3:[function(u,f,E){(function(T){"use strict";typeof T.Promise!="function"&&(T.Promise=u(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"2":2}],4:[function(u,f,E){"use strict";var T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function w(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function L(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch(t){return}}var B=L();function k(){try{if(!B||!B.open)return!1;var t=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),o=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!t||o)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch(a){return!1}}function V(t,o){t=t||[],o=o||{};try{return new Blob(t,o)}catch(i){if(i.name!=="TypeError")throw i;for(var a=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,s=new a,c=0;c<t.length;c+=1)s.append(t[c]);return s.getBlob(o.type)}}typeof Promise>"u"&&u(3);var y=Promise;function P(t,o){o&&t.then(function(a){o(null,a)},function(a){o(a)})}function U(t,o,a){typeof o=="function"&&t.then(o),typeof a=="function"&&t.catch(a)}function $(t){return typeof t!="string"&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function Q(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var G="local-forage-detect-blob-support",re=void 0,X={},Ge=Object.prototype.toString,ue="readonly",g="readwrite";function H(t){for(var o=t.length,a=new ArrayBuffer(o),s=new Uint8Array(a),c=0;c<o;c++)s[c]=t.charCodeAt(c);return a}function A(t){return new y(function(o){var a=t.transaction(G,g),s=V([""]);a.objectStore(G).put(s,"key"),a.onabort=function(c){c.preventDefault(),c.stopPropagation(),o(!1)},a.oncomplete=function(){var c=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);o(i||!c||parseInt(c[1],10)>=43)}}).catch(function(){return!1})}function N(t){return typeof re=="boolean"?y.resolve(re):A(t).then(function(o){return re=o,re})}function z(t){var o=X[t.name],a={};a.promise=new y(function(s,c){a.resolve=s,a.reject=c}),o.deferredOperations.push(a),o.dbReady?o.dbReady=o.dbReady.then(function(){return a.promise}):o.dbReady=a.promise}function K(t){var o=X[t.name],a=o.deferredOperations.pop();if(a)return a.resolve(),a.promise}function q(t,o){var a=X[t.name],s=a.deferredOperations.pop();if(s)return s.reject(o),s.promise}function J(t,o){return new y(function(a,s){if(X[t.name]=X[t.name]||Qt(),t.db)if(o)z(t),t.db.close();else return a(t.db);var c=[t.name];o&&c.push(t.version);var i=B.open.apply(B,c);o&&(i.onupgradeneeded=function(l){var m=i.result;try{m.createObjectStore(t.storeName),l.oldVersion<=1&&m.createObjectStore(G)}catch(h){if(h.name==="ConstraintError")console.warn('The database "'+t.name+'" has been upgraded from version '+l.oldVersion+" to version "+l.newVersion+', but the storage "'+t.storeName+'" already exists.');else throw h}}),i.onerror=function(l){l.preventDefault(),s(i.error)},i.onsuccess=function(){var l=i.result;l.onversionchange=function(m){m.target.close()},a(l),K(t)}})}function ne(t){return J(t,!1)}function ye(t){return J(t,!0)}function Ae(t,o){if(!t.db)return!0;var a=!t.db.objectStoreNames.contains(t.storeName),s=t.version<t.db.version,c=t.version>t.db.version;if(s&&(t.version!==o&&console.warn('The database "'+t.name+`" can't be downgraded from version `+t.db.version+" to version "+t.version+"."),t.version=t.db.version),c||a){if(a){var i=t.db.version+1;i>t.version&&(t.version=i)}return!0}return!1}function Xe(t){return new y(function(o,a){var s=new FileReader;s.onerror=a,s.onloadend=function(c){var i=btoa(c.target.result||"");o({__local_forage_encoded_blob:!0,data:i,type:t.type})},s.readAsBinaryString(t)})}function de(t){var o=H(atob(t.data));return V([o],{type:t.type})}function Yt(t){return t&&t.__local_forage_encoded_blob}function Kr(t){var o=this,a=o._initReady().then(function(){var s=X[o._dbInfo.name];if(s&&s.dbReady)return s.dbReady});return U(a,t,t),a}function Yr(t){z(t);for(var o=X[t.name],a=o.forages,s=0;s<a.length;s++){var c=a[s];c._dbInfo.db&&(c._dbInfo.db.close(),c._dbInfo.db=null)}return t.db=null,ne(t).then(function(i){return t.db=i,Ae(t)?ye(t):i}).then(function(i){t.db=o.db=i;for(var l=0;l<a.length;l++)a[l]._dbInfo.db=i}).catch(function(i){throw q(t,i),i})}function ae(t,o,a,s){s===void 0&&(s=1);try{var c=t.db.transaction(t.storeName,o);a(null,c)}catch(i){if(s>0&&(!t.db||i.name==="InvalidStateError"||i.name==="NotFoundError"))return y.resolve().then(function(){if(!t.db||i.name==="NotFoundError"&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),ye(t)}).then(function(){return Yr(t).then(function(){ae(t,o,a,s-1)})}).catch(a);a(i)}}function Qt(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Qr(t){var o=this,a={db:null};if(t)for(var s in t)a[s]=t[s];var c=X[a.name];c||(c=Qt(),X[a.name]=c),c.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=Kr);var i=[];function l(){return y.resolve()}for(var m=0;m<c.forages.length;m++){var h=c.forages[m];h!==o&&i.push(h._initReady().catch(l))}var p=c.forages.slice(0);return y.all(i).then(function(){return a.db=c.db,ne(a)}).then(function(b){return a.db=b,Ae(a,o._defaultConfig.version)?ye(a):b}).then(function(b){a.db=c.db=b,o._dbInfo=a;for(var S=0;S<p.length;S++){var R=p[S];R!==o&&(R._dbInfo.db=a.db,R._dbInfo.version=a.version)}})}function qr(t,o){var a=this;t=$(t);var s=new y(function(c,i){a.ready().then(function(){ae(a._dbInfo,ue,function(l,m){if(l)return i(l);try{var h=m.objectStore(a._dbInfo.storeName),p=h.get(t);p.onsuccess=function(){var b=p.result;b===void 0&&(b=null),Yt(b)&&(b=de(b)),c(b)},p.onerror=function(){i(p.error)}}catch(b){i(b)}})}).catch(i)});return P(s,o),s}function Jr(t,o){var a=this,s=new y(function(c,i){a.ready().then(function(){ae(a._dbInfo,ue,function(l,m){if(l)return i(l);try{var h=m.objectStore(a._dbInfo.storeName),p=h.openCursor(),b=1;p.onsuccess=function(){var S=p.result;if(S){var R=S.value;Yt(R)&&(R=de(R));var D=t(R,S.key,b++);D!==void 0?c(D):S.continue()}else c()},p.onerror=function(){i(p.error)}}catch(S){i(S)}})}).catch(i)});return P(s,o),s}function Zr(t,o,a){var s=this;t=$(t);var c=new y(function(i,l){var m;s.ready().then(function(){return m=s._dbInfo,Ge.call(o)==="[object Blob]"?N(m.db).then(function(h){return h?o:Xe(o)}):o}).then(function(h){ae(s._dbInfo,g,function(p,b){if(p)return l(p);try{var S=b.objectStore(s._dbInfo.storeName);h===null&&(h=void 0);var R=S.put(h,t);b.oncomplete=function(){h===void 0&&(h=null),i(h)},b.onabort=b.onerror=function(){var D=R.error?R.error:R.transaction.error;l(D)}}catch(D){l(D)}})}).catch(l)});return P(c,a),c}function jr(t,o){var a=this;t=$(t);var s=new y(function(c,i){a.ready().then(function(){ae(a._dbInfo,g,function(l,m){if(l)return i(l);try{var h=m.objectStore(a._dbInfo.storeName),p=h.delete(t);m.oncomplete=function(){c()},m.onerror=function(){i(p.error)},m.onabort=function(){var b=p.error?p.error:p.transaction.error;i(b)}}catch(b){i(b)}})}).catch(i)});return P(s,o),s}function en(t){var o=this,a=new y(function(s,c){o.ready().then(function(){ae(o._dbInfo,g,function(i,l){if(i)return c(i);try{var m=l.objectStore(o._dbInfo.storeName),h=m.clear();l.oncomplete=function(){s()},l.onabort=l.onerror=function(){var p=h.error?h.error:h.transaction.error;c(p)}}catch(p){c(p)}})}).catch(c)});return P(a,t),a}function tn(t){var o=this,a=new y(function(s,c){o.ready().then(function(){ae(o._dbInfo,ue,function(i,l){if(i)return c(i);try{var m=l.objectStore(o._dbInfo.storeName),h=m.count();h.onsuccess=function(){s(h.result)},h.onerror=function(){c(h.error)}}catch(p){c(p)}})}).catch(c)});return P(a,t),a}function rn(t,o){var a=this,s=new y(function(c,i){if(t<0){c(null);return}a.ready().then(function(){ae(a._dbInfo,ue,function(l,m){if(l)return i(l);try{var h=m.objectStore(a._dbInfo.storeName),p=!1,b=h.openKeyCursor();b.onsuccess=function(){var S=b.result;if(!S){c(null);return}t===0||p?c(S.key):(p=!0,S.advance(t))},b.onerror=function(){i(b.error)}}catch(S){i(S)}})}).catch(i)});return P(s,o),s}function nn(t){var o=this,a=new y(function(s,c){o.ready().then(function(){ae(o._dbInfo,ue,function(i,l){if(i)return c(i);try{var m=l.objectStore(o._dbInfo.storeName),h=m.openKeyCursor(),p=[];h.onsuccess=function(){var b=h.result;if(!b){s(p);return}p.push(b.key),b.continue()},h.onerror=function(){c(h.error)}}catch(b){c(b)}})}).catch(c)});return P(a,t),a}function an(t,o){o=Q.apply(this,arguments);var a=this.config();t=typeof t!="function"&&t||{},t.name||(t.name=t.name||a.name,t.storeName=t.storeName||a.storeName);var s=this,c;if(!t.name)c=y.reject("Invalid arguments");else{var i=t.name===a.name&&s._dbInfo.db,l=i?y.resolve(s._dbInfo.db):ne(t).then(function(m){var h=X[t.name],p=h.forages;h.db=m;for(var b=0;b<p.length;b++)p[b]._dbInfo.db=m;return m});t.storeName?c=l.then(function(m){if(!!m.objectStoreNames.contains(t.storeName)){var h=m.version+1;z(t);var p=X[t.name],b=p.forages;m.close();for(var S=0;S<b.length;S++){var R=b[S];R._dbInfo.db=null,R._dbInfo.version=h}var D=new y(function(_,O){var F=B.open(t.name,h);F.onerror=function(Z){var Te=F.result;Te.close(),O(Z)},F.onupgradeneeded=function(){var Z=F.result;Z.deleteObjectStore(t.storeName)},F.onsuccess=function(){var Z=F.result;Z.close(),_(Z)}});return D.then(function(_){p.db=_;for(var O=0;O<b.length;O++){var F=b[O];F._dbInfo.db=_,K(F._dbInfo)}}).catch(function(_){throw(q(t,_)||y.resolve()).catch(function(){}),_})}}):c=l.then(function(m){z(t);var h=X[t.name],p=h.forages;m.close();for(var b=0;b<p.length;b++){var S=p[b];S._dbInfo.db=null}var R=new y(function(D,_){var O=B.deleteDatabase(t.name);O.onerror=function(){var F=O.result;F&&F.close(),_(O.error)},O.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},O.onsuccess=function(){var F=O.result;F&&F.close(),D(F)}});return R.then(function(D){h.db=D;for(var _=0;_<p.length;_++){var O=p[_];K(O._dbInfo)}}).catch(function(D){throw(q(t,D)||y.resolve()).catch(function(){}),D})})}return P(c,o),c}var on={_driver:"asyncStorage",_initStorage:Qr,_support:k(),iterate:Jr,getItem:qr,setItem:Zr,removeItem:jr,clear:en,length:tn,key:rn,keys:nn,dropInstance:an};function sn(){return typeof openDatabase=="function"}var se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",cn="~~local_forage_type~",qt=/^~~local_forage_type~([^~]+)~/,Ie="__lfsc__:",We=Ie.length,ze="arbf",Ve="blob",Jt="si08",Zt="ui08",jt="uic8",er="si16",tr="si32",rr="ur16",nr="ui32",ar="fl32",or="fl64",ir=We+ze.length,sr=Object.prototype.toString;function cr(t){var o=t.length*.75,a=t.length,s,c=0,i,l,m,h;t[t.length-1]==="="&&(o--,t[t.length-2]==="="&&o--);var p=new ArrayBuffer(o),b=new Uint8Array(p);for(s=0;s<a;s+=4)i=se.indexOf(t[s]),l=se.indexOf(t[s+1]),m=se.indexOf(t[s+2]),h=se.indexOf(t[s+3]),b[c++]=i<<2|l>>4,b[c++]=(l&15)<<4|m>>2,b[c++]=(m&3)<<6|h&63;return p}function Ke(t){var o=new Uint8Array(t),a="",s;for(s=0;s<o.length;s+=3)a+=se[o[s]>>2],a+=se[(o[s]&3)<<4|o[s+1]>>4],a+=se[(o[s+1]&15)<<2|o[s+2]>>6],a+=se[o[s+2]&63];return o.length%3===2?a=a.substring(0,a.length-1)+"=":o.length%3===1&&(a=a.substring(0,a.length-2)+"=="),a}function un(t,o){var a="";if(t&&(a=sr.call(t)),t&&(a==="[object ArrayBuffer]"||t.buffer&&sr.call(t.buffer)==="[object ArrayBuffer]")){var s,c=Ie;t instanceof ArrayBuffer?(s=t,c+=ze):(s=t.buffer,a==="[object Int8Array]"?c+=Jt:a==="[object Uint8Array]"?c+=Zt:a==="[object Uint8ClampedArray]"?c+=jt:a==="[object Int16Array]"?c+=er:a==="[object Uint16Array]"?c+=rr:a==="[object Int32Array]"?c+=tr:a==="[object Uint32Array]"?c+=nr:a==="[object Float32Array]"?c+=ar:a==="[object Float64Array]"?c+=or:o(new Error("Failed to get type for BinaryArray"))),o(c+Ke(s))}else if(a==="[object Blob]"){var i=new FileReader;i.onload=function(){var l=cn+t.type+"~"+Ke(this.result);o(Ie+Ve+l)},i.readAsArrayBuffer(t)}else try{o(JSON.stringify(t))}catch(l){console.error("Couldn't convert value into a JSON string: ",t),o(null,l)}}function fn(t){if(t.substring(0,We)!==Ie)return JSON.parse(t);var o=t.substring(ir),a=t.substring(We,ir),s;if(a===Ve&&qt.test(o)){var c=o.match(qt);s=c[1],o=o.substring(c[0].length)}var i=cr(o);switch(a){case ze:return i;case Ve:return V([i],{type:s});case Jt:return new Int8Array(i);case Zt:return new Uint8Array(i);case jt:return new Uint8ClampedArray(i);case er:return new Int16Array(i);case rr:return new Uint16Array(i);case tr:return new Int32Array(i);case nr:return new Uint32Array(i);case ar:return new Float32Array(i);case or:return new Float64Array(i);default:throw new Error("Unkown type: "+a)}}var Ye={serialize:un,deserialize:fn,stringToBuffer:cr,bufferToString:Ke};function ur(t,o,a,s){t.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],a,s)}function ln(t){var o=this,a={db:null};if(t)for(var s in t)a[s]=typeof t[s]!="string"?t[s].toString():t[s];var c=new y(function(i,l){try{a.db=openDatabase(a.name,String(a.version),a.description,a.size)}catch(m){return l(m)}a.db.transaction(function(m){ur(m,a,function(){o._dbInfo=a,i()},function(h,p){l(p)})},l)});return a.serializer=Ye,c}function ce(t,o,a,s,c,i){t.executeSql(a,s,c,function(l,m){m.code===m.SYNTAX_ERR?l.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[o.storeName],function(h,p){p.rows.length?i(h,m):ur(h,o,function(){h.executeSql(a,s,c,i)},i)},i):i(l,m)},i)}function mn(t,o){var a=this;t=$(t);var s=new y(function(c,i){a.ready().then(function(){var l=a._dbInfo;l.db.transaction(function(m){ce(m,l,"SELECT * FROM "+l.storeName+" WHERE key = ? LIMIT 1",[t],function(h,p){var b=p.rows.length?p.rows.item(0).value:null;b&&(b=l.serializer.deserialize(b)),c(b)},function(h,p){i(p)})})}).catch(i)});return P(s,o),s}function dn(t,o){var a=this,s=new y(function(c,i){a.ready().then(function(){var l=a._dbInfo;l.db.transaction(function(m){ce(m,l,"SELECT * FROM "+l.storeName,[],function(h,p){for(var b=p.rows,S=b.length,R=0;R<S;R++){var D=b.item(R),_=D.value;if(_&&(_=l.serializer.deserialize(_)),_=t(_,D.key,R+1),_!==void 0){c(_);return}}c()},function(h,p){i(p)})})}).catch(i)});return P(s,o),s}function fr(t,o,a,s){var c=this;t=$(t);var i=new y(function(l,m){c.ready().then(function(){o===void 0&&(o=null);var h=o,p=c._dbInfo;p.serializer.serialize(o,function(b,S){S?m(S):p.db.transaction(function(R){ce(R,p,"INSERT OR REPLACE INTO "+p.storeName+" (key, value) VALUES (?, ?)",[t,b],function(){l(h)},function(D,_){m(_)})},function(R){if(R.code===R.QUOTA_ERR){if(s>0){l(fr.apply(c,[t,h,a,s-1]));return}m(R)}})})}).catch(m)});return P(i,a),i}function hn(t,o,a){return fr.apply(this,[t,o,a,1])}function pn(t,o){var a=this;t=$(t);var s=new y(function(c,i){a.ready().then(function(){var l=a._dbInfo;l.db.transaction(function(m){ce(m,l,"DELETE FROM "+l.storeName+" WHERE key = ?",[t],function(){c()},function(h,p){i(p)})})}).catch(i)});return P(s,o),s}function vn(t){var o=this,a=new y(function(s,c){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(l){ce(l,i,"DELETE FROM "+i.storeName,[],function(){s()},function(m,h){c(h)})})}).catch(c)});return P(a,t),a}function bn(t){var o=this,a=new y(function(s,c){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(l){ce(l,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],function(m,h){var p=h.rows.item(0).c;s(p)},function(m,h){c(h)})})}).catch(c)});return P(a,t),a}function gn(t,o){var a=this,s=new y(function(c,i){a.ready().then(function(){var l=a._dbInfo;l.db.transaction(function(m){ce(m,l,"SELECT key FROM "+l.storeName+" WHERE id = ? LIMIT 1",[t+1],function(h,p){var b=p.rows.length?p.rows.item(0).key:null;c(b)},function(h,p){i(p)})})}).catch(i)});return P(s,o),s}function yn(t){var o=this,a=new y(function(s,c){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(l){ce(l,i,"SELECT key FROM "+i.storeName,[],function(m,h){for(var p=[],b=0;b<h.rows.length;b++)p.push(h.rows.item(b).key);s(p)},function(m,h){c(h)})})}).catch(c)});return P(a,t),a}function En(t){return new y(function(o,a){t.transaction(function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(c,i){for(var l=[],m=0;m<i.rows.length;m++)l.push(i.rows.item(m).name);o({db:t,storeNames:l})},function(c,i){a(i)})},function(s){a(s)})})}function Tn(t,o){o=Q.apply(this,arguments);var a=this.config();t=typeof t!="function"&&t||{},t.name||(t.name=t.name||a.name,t.storeName=t.storeName||a.storeName);var s=this,c;return t.name?c=new y(function(i){var l;t.name===a.name?l=s._dbInfo.db:l=openDatabase(t.name,"","",0),t.storeName?i({db:l,storeNames:[t.storeName]}):i(En(l))}).then(function(i){return new y(function(l,m){i.db.transaction(function(h){function p(D){return new y(function(_,O){h.executeSql("DROP TABLE IF EXISTS "+D,[],function(){_()},function(F,Z){O(Z)})})}for(var b=[],S=0,R=i.storeNames.length;S<R;S++)b.push(p(i.storeNames[S]));y.all(b).then(function(){l()}).catch(function(D){m(D)})},function(h){m(h)})})}):c=y.reject("Invalid arguments"),P(c,o),c}var Sn={_driver:"webSQLStorage",_initStorage:ln,_support:sn(),iterate:dn,getItem:mn,setItem:hn,removeItem:pn,clear:vn,length:bn,key:gn,keys:yn,dropInstance:Tn};function Mn(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}function lr(t,o){var a=t.name+"/";return t.storeName!==o.storeName&&(a+=t.storeName+"/"),a}function Ln(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(o){return!0}}function Pn(){return!Ln()||localStorage.length>0}function xn(t){var o=this,a={};if(t)for(var s in t)a[s]=t[s];return a.keyPrefix=lr(t,o._defaultConfig),Pn()?(o._dbInfo=a,a.serializer=Ye,y.resolve()):y.reject()}function Cn(t){var o=this,a=o.ready().then(function(){for(var s=o._dbInfo.keyPrefix,c=localStorage.length-1;c>=0;c--){var i=localStorage.key(c);i.indexOf(s)===0&&localStorage.removeItem(i)}});return P(a,t),a}function Rn(t,o){var a=this;t=$(t);var s=a.ready().then(function(){var c=a._dbInfo,i=localStorage.getItem(c.keyPrefix+t);return i&&(i=c.serializer.deserialize(i)),i});return P(s,o),s}function wn(t,o){var a=this,s=a.ready().then(function(){for(var c=a._dbInfo,i=c.keyPrefix,l=i.length,m=localStorage.length,h=1,p=0;p<m;p++){var b=localStorage.key(p);if(b.indexOf(i)===0){var S=localStorage.getItem(b);if(S&&(S=c.serializer.deserialize(S)),S=t(S,b.substring(l),h++),S!==void 0)return S}}});return P(s,o),s}function An(t,o){var a=this,s=a.ready().then(function(){var c=a._dbInfo,i;try{i=localStorage.key(t)}catch(l){i=null}return i&&(i=i.substring(c.keyPrefix.length)),i});return P(s,o),s}function In(t){var o=this,a=o.ready().then(function(){for(var s=o._dbInfo,c=localStorage.length,i=[],l=0;l<c;l++){var m=localStorage.key(l);m.indexOf(s.keyPrefix)===0&&i.push(m.substring(s.keyPrefix.length))}return i});return P(a,t),a}function Hn(t){var o=this,a=o.keys().then(function(s){return s.length});return P(a,t),a}function Dn(t,o){var a=this;t=$(t);var s=a.ready().then(function(){var c=a._dbInfo;localStorage.removeItem(c.keyPrefix+t)});return P(s,o),s}function _n(t,o,a){var s=this;t=$(t);var c=s.ready().then(function(){o===void 0&&(o=null);var i=o;return new y(function(l,m){var h=s._dbInfo;h.serializer.serialize(o,function(p,b){if(b)m(b);else try{localStorage.setItem(h.keyPrefix+t,p),l(i)}catch(S){(S.name==="QuotaExceededError"||S.name==="NS_ERROR_DOM_QUOTA_REACHED")&&m(S),m(S)}})})});return P(c,a),c}function Bn(t,o){if(o=Q.apply(this,arguments),t=typeof t!="function"&&t||{},!t.name){var a=this.config();t.name=t.name||a.name,t.storeName=t.storeName||a.storeName}var s=this,c;return t.name?c=new y(function(i){t.storeName?i(lr(t,s._defaultConfig)):i(t.name+"/")}).then(function(i){for(var l=localStorage.length-1;l>=0;l--){var m=localStorage.key(l);m.indexOf(i)===0&&localStorage.removeItem(m)}}):c=y.reject("Invalid arguments"),P(c,o),c}var Nn={_driver:"localStorageWrapper",_initStorage:xn,_support:Mn(),iterate:wn,getItem:Rn,setItem:_n,removeItem:Dn,clear:Cn,length:Hn,key:An,keys:In,dropInstance:Bn},kn=function(o,a){return o===a||typeof o=="number"&&typeof a=="number"&&isNaN(o)&&isNaN(a)},Un=function(o,a){for(var s=o.length,c=0;c<s;){if(kn(o[c],a))return!0;c++}return!1},mr=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"},Ee={},dr={},he={INDEXEDDB:on,WEBSQL:Sn,LOCALSTORAGE:Nn},$n=[he.INDEXEDDB._driver,he.WEBSQL._driver,he.LOCALSTORAGE._driver],He=["dropInstance"],Qe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(He),Fn={description:"",driver:$n.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function On(t,o){t[o]=function(){var a=arguments;return t.ready().then(function(){return t[o].apply(t,a)})}}function qe(){for(var t=1;t<arguments.length;t++){var o=arguments[t];if(o)for(var a in o)o.hasOwnProperty(a)&&(mr(o[a])?arguments[0][a]=o[a].slice():arguments[0][a]=o[a])}return arguments[0]}var Gn=function(){function t(o){w(this,t);for(var a in he)if(he.hasOwnProperty(a)){var s=he[a],c=s._driver;this[a]=c,Ee[c]||this.defineDriver(s)}this._defaultConfig=qe({},Fn),this._config=qe({},this._defaultConfig,o),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(a){if((typeof a>"u"?"undefined":T(a))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var s in a){if(s==="storeName"&&(a[s]=a[s].replace(/\W/g,"_")),s==="version"&&typeof a[s]!="number")return new Error("Database version must be a number.");this._config[s]=a[s]}return"driver"in a&&a.driver?this.setDriver(this._config.driver):!0}else return typeof a=="string"?this._config[a]:this._config},t.prototype.defineDriver=function(a,s,c){var i=new y(function(l,m){try{var h=a._driver,p=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver){m(p);return}for(var b=Qe.concat("_initStorage"),S=0,R=b.length;S<R;S++){var D=b[S],_=!Un(He,D);if((_||a[D])&&typeof a[D]!="function"){m(p);return}}var O=function(){for(var Te=function(zn){return function(){var Vn=new Error("Method "+zn+" is not implemented by the current driver"),hr=y.reject(Vn);return P(hr,arguments[arguments.length-1]),hr}},Je=0,Wn=He.length;Je<Wn;Je++){var Ze=He[Je];a[Ze]||(a[Ze]=Te(Ze))}};O();var F=function(Te){Ee[h]&&console.info("Redefining LocalForage driver: "+h),Ee[h]=a,dr[h]=Te,l()};"_support"in a?a._support&&typeof a._support=="function"?a._support().then(F,m):F(!!a._support):F(!0)}catch(Z){m(Z)}});return U(i,s,c),i},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(a,s,c){var i=Ee[a]?y.resolve(Ee[a]):y.reject(new Error("Driver not found."));return U(i,s,c),i},t.prototype.getSerializer=function(a){var s=y.resolve(Ye);return U(s,a),s},t.prototype.ready=function(a){var s=this,c=s._driverSet.then(function(){return s._ready===null&&(s._ready=s._initDriver()),s._ready});return U(c,a,a),c},t.prototype.setDriver=function(a,s,c){var i=this;mr(a)||(a=[a]);var l=this._getSupportedDrivers(a);function m(){i._config.driver=i.driver()}function h(S){return i._extend(S),m(),i._ready=i._initStorage(i._config),i._ready}function p(S){return function(){var R=0;function D(){for(;R<S.length;){var _=S[R];return R++,i._dbInfo=null,i._ready=null,i.getDriver(_).then(h).catch(D)}m();var O=new Error("No available storage method found.");return i._driverSet=y.reject(O),i._driverSet}return D()}}var b=this._driverSet!==null?this._driverSet.catch(function(){return y.resolve()}):y.resolve();return this._driverSet=b.then(function(){var S=l[0];return i._dbInfo=null,i._ready=null,i.getDriver(S).then(function(R){i._driver=R._driver,m(),i._wrapLibraryMethodsWithReady(),i._initDriver=p(l)})}).catch(function(){m();var S=new Error("No available storage method found.");return i._driverSet=y.reject(S),i._driverSet}),U(this._driverSet,s,c),this._driverSet},t.prototype.supports=function(a){return!!dr[a]},t.prototype._extend=function(a){qe(this,a)},t.prototype._getSupportedDrivers=function(a){for(var s=[],c=0,i=a.length;c<i;c++){var l=a[c];this.supports(l)&&s.push(l)}return s},t.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,s=Qe.length;a<s;a++)On(this,Qe[a])},t.prototype.createInstance=function(a){return new t(a)},t}(),Xn=new Gn;f.exports=Xn},{"3":3}]},{},[4])(4)})});var tt=r=>{let e=typeof r;return r!==null&&(e==="object"||e==="function")},et=new Set(["__proto__","prototype","constructor"]),na=new Set("0123456789");function yr(r){let e=[],n="",u="start",f=!1;for(let E of r)switch(E){case"\\":if(u==="index")throw new Error("Invalid character in an index");if(u==="indexEnd")throw new Error("Invalid character after an index");f&&(n+=E),u="property",f=!f;break;case".":if(u==="index")throw new Error("Invalid character in an index");if(u==="indexEnd"){u="property";break}if(f){f=!1,n+=E;break}if(et.has(n))return[];e.push(n),n="",u="property";break;case"[":if(u==="index")throw new Error("Invalid character in an index");if(u==="indexEnd"){u="index";break}if(f){f=!1,n+=E;break}if(u==="property"){if(et.has(n))return[];e.push(n),n=""}u="index";break;case"]":if(u==="index"){e.push(Number.parseInt(n,10)),n="",u="indexEnd";break}if(u==="indexEnd")throw new Error("Invalid character after an index");default:if(u==="index"&&!na.has(E))throw new Error("Invalid character in an index");if(u==="indexEnd")throw new Error("Invalid character after an index");u==="start"&&(u="property"),f&&(f=!1,n+="\\"),n+=E}switch(f&&(n+="\\"),u){case"property":{if(et.has(n))return[];e.push(n);break}case"index":throw new Error("Index was not closed");case"start":{e.push("");break}}return e}function Er(r,e){if(typeof e!="number"&&Array.isArray(r)){let n=Number.parseInt(e,10);return Number.isInteger(n)&&r[n]===r[e]}return!1}function aa(r,e){if(Er(r,e))throw new Error("Cannot use string index")}function x(r,e,n){if(!tt(r)||typeof e!="string")return n===void 0?r:n;let u=yr(e);if(u.length===0)return n;for(let f=0;f<u.length;f++){let E=u[f];if(Er(r,E)?r=f===u.length-1?void 0:null:r=r[E],r==null){if(f!==u.length-1)return n;break}}return r===void 0?n:r}function Tr(r,e,n){if(!tt(r)||typeof e!="string")return r;let u=r,f=yr(e);for(let E=0;E<f.length;E++){let T=f[E];aa(r,T),E===f.length-1?r[T]=n:tt(r[T])||(r[T]=typeof f[E+1]=="number"?[]:{}),r=r[T]}return u}var Oe=ra(Mr());var I=r=>document.getElementById(r),Lr=(r,e)=>{if(document.visibilityState==="hidden")return!1;let n=Object.entries(e);for(let[u,f]of n)r[u]=f;return!0},d=(r,e)=>document.visibilityState==="hidden"?!1:Lr(I(r),e),C=(r,e)=>document.visibilityState==="hidden"?!1:Lr(I(r).style,e);var ie=(r,e)=>r.querySelector(e),oa=(r,e)=>{let n=I("confirmationBox"),u=I("confirmWrapper"),f=ie(document,"#confirm"),E=ie(document,"#transparentBG"),T=ie(f,"#okConfirm"),w=ie(f,"#cancelConfirm");n.style.display="block",u.style.display="block",E.style.display="block",ie(f,"p").textContent=r,f.focus();let L=({target:k})=>{let V=k;return T.removeEventListener("click",L),w.removeEventListener("click",L),f.removeEventListener("keyup",B),n.style.display="none",u.style.display="none",E.style.display="none",e(V===T)},B=k=>k.key==="Enter"||k.key===" "?L({target:T}):k.key==="Escape"?L({target:w}):k.preventDefault();T.addEventListener("click",L),w.addEventListener("click",L),f.addEventListener("keyup",B)},ia=(r,e)=>{let n=I("confirmationBox"),u=I("alertWrapper"),f=ie(document,"#transparentBG"),E=ie(document,"#alert"),T=ie(E,"#okAlert");n.style.display="block",u.style.display="block",f.style.display="block",ie(E,"p").textContent=r,E.focus();let w=()=>{T.removeEventListener("click",w),E.removeEventListener("keyup",L),n.style.display="none",u.style.display="none",f.style.display="none",e(void 0)},L=B=>(B.key==="Enter"||B.key===" ")&&w();T.addEventListener("click",w),E.addEventListener("keyup",L)};var j=r=>new Promise(e=>ia(r,e));var De=r=>new Promise(e=>oa(r,e));var v=(r,e=0)=>{if(r<0)return"-"+v(-r,e);if(r>=1e6){let B=Math.floor(Math.log10(r));return r/=Math.pow(10,B),v(r,2)+"e"+v(B)}let n=Math.floor(r),u=r-n,f=n.toLocaleString(),E=e>0&&r!==0,T=Math.pow(10,e)*u,w=1e-6;Math.ceil(T)-T<w&&(T=Math.ceil(T));let L=E?Math.floor(T).toString():"";if(L!==""){for(;L.length<e;)L="0"+L;L="."+L}return f+L};var Pr=(r,e,n,u=1)=>Math.ceil(r*(Math.pow(n,u)-Math.pow(e,u)));var Me=r=>new Promise(e=>setTimeout(e,r));var sa={HP:120,MP:10,ATK:15,STR:0,DEF:15,ARMOR:0,CRITCHANCE:0,CRITDAMAGE:100},xr=class{constructor(e,n){this.baseStats=oe({},e),this.currStats=oe({},e),this.attackRate=n,this.delay=0,this.updateHTML("Initialize")}async decreaseDelay(e){this.delay-=e,_e&&this.delay<0&&await this.attack()}computeArmorDamageReduction(){return this.currStats.ARMOR}computeDefenseDamageDivisor(){let e=this.baseStats.DEF;return 1+e/100}computeActualDamageReceived(e){let n=this.computeArmorDamageReduction(),u=this.computeDefenseDamageDivisor();return Math.max(0,e-n/u)}async takeDamage(e){if(this.currStats.HP===0)return;let n=this.computeActualDamageReceived(e);this.currStats.HP-=n,this.currStats.HP=Math.max(0,this.currStats.HP),this.updateHTML("Damage"),this.currStats.HP===0&&(await Me(1e3),this.currStats=oe({},this.baseStats),this.delay=this.attackRate,this.updateHTML("Initialize"),pe())}computeStrengthModifier(){let e=this.currStats.STR;return 1+e/100}computeDamageBase(){return 1+this.currStats.ATK}computeCriticalDamage(){return this.currStats.CRITDAMAGE/100}computeBaseDamageSent(){let e=this.computeDamageBase(),n=this.computeStrengthModifier(),u=1;return Math.random()<this.currStats.CRITCHANCE&&(u=this.computeCriticalDamage()),e*n*u}async attack(){if(this.delay>0||this.currStats.HP===0)return;let e=this.computeBaseDamageSent();await ee.takeDamage(e),this.delay=this.attackRate}computeHPBarWidth(){return 100*(this.currStats.HP/this.baseStats.HP)}computeMPBarWidth(){return 100*(this.currStats.MP/this.baseStats.MP)}updateHTML(e){if(e==="Initialize"&&(d("playerATK",{textContent:`ATK ${this.baseStats.ATK}`}),d("playerSTR",{textContent:`STR ${this.baseStats.STR}`}),d("playerDEF",{textContent:`DEF ${this.baseStats.DEF}`}),d("playerARMOR",{textContent:`ARMOR ${this.baseStats.ARMOR}`}),d("playerCritChance",{textContent:`CritChance ${this.baseStats.CRITCHANCE}`}),d("playerCritDamage",{textContent:`CritDamage ${this.baseStats.CRITDAMAGE}`})),e==="Initialize"||e==="Damage"){d("playerHPText",{textContent:`${v(this.currStats.HP,2)}/${v(this.baseStats.HP)}`});let n=this.computeHPBarWidth();C("playerHPProgression",{width:`${n}%`})}if(e==="Initialize"||e==="Ability"){d("playerMPText",{textContent:`${v(this.currStats.MP,2)}/${v(this.baseStats.MP)}`});let n=this.computeMPBarWidth();C("playerMPProgression",{width:`${n}%`})}}},fe=new xr(sa,.666),_e=!1,Cr=()=>{_e=!_e,d("autoAttack",{textContent:`Auto Fight: ${_e}`})};var Y=class{constructor(e,n){this.baseStats=oe({},e),this.currStats=oe({},e),this.attackRate=n,this.delay=this.attackRate,this.level=this.computeGeneratedLevel(),this.updateHTML("Initialize")}async generateAttacks(e){await this.checkMoveUse()&&(this.delay-=e,this.delay<0&&(this.makeMove(),this.delay=this.attackRate))}computeGeneratedLevel(){let e=1;return e+=Math.min(25,3*Math.log10(1+this.baseStats.HP)),e+=Math.min(25,3*Math.log10(1+this.baseStats.ATK)),e+=Math.min(25,3*Math.log10(1+this.baseStats.DEF)),e+=Math.min(10,this.baseStats.CRITCHANCE/10),e+=Math.min(13,4*Math.log10(this.baseStats.CRITDAMAGE/100)),e}computeArmorDamageReduction(){return this.currStats.ARMOR*(this.currStats.HP/this.baseStats.HP)}computeDefenseDamageDivisor(){let e=this.currStats.DEF;return 1+e/100}computeActualDamageReceived(e){let n=this.computeArmorDamageReduction(),u=this.computeDefenseDamageDivisor();return Math.max(0,e-n/u)}async takeDamage(e){if(this.currStats.HP===0)return;let n=this.computeActualDamageReceived(e);this.currStats.HP-=n,this.currStats.HP=Math.max(0,this.currStats.HP),this.updateHTML("Damage"),this.currStats.HP===0&&(await Me(1e3),pe())}computeStrengthModifier(){let e=this.currStats.STR;return 1+e*(1-this.currStats.HP/this.baseStats.HP)/100}computeDamageBase(){return 1+this.currStats.ATK}computeCriticalDamage(){return this.currStats.CRITDAMAGE/100}computeBaseDamageSent(){let e=this.computeDamageBase(),n=this.computeStrengthModifier(),u=1;return Math.random()<this.currStats.CRITCHANCE&&(u=this.computeCriticalDamage()),e*n*u}computeHPBarWidth(){return 100*(this.currStats.HP/this.baseStats.HP)}computeMPBarWidth(){return 100*(this.currStats.MP/this.baseStats.MP)}makeMove(){this.enemyAI()}updateHTML(e){if((e==="Initialize"||e=="StatChange")&&(d("enemyATK",{textContent:`ATK ${this.currStats.ATK}`}),d("enemySTR",{textContent:`STR ${this.currStats.STR}`}),d("enemyDEF",{textContent:`DEF ${this.currStats.DEF}`}),d("enemyARMOR",{textContent:`ARMOR ${this.currStats.ARMOR}`}),d("enemyCritChance",{textContent:`CritChance ${this.currStats.CRITCHANCE}`}),d("enemyCritDamage",{textContent:`CritDamage ${this.currStats.CRITDAMAGE}`})),e==="Initialize"||e==="Damage"){d("enemyHPText",{textContent:`${v(this.currStats.HP,2)}/${v(this.baseStats.HP)}`});let n=this.computeHPBarWidth();C("enemyHPProgression",{width:`${n}%`})}if(e==="Initialize"||e==="Ability"){d("enemyMPText",{textContent:`${v(this.currStats.MP,2)}/${v(this.baseStats.MP)}`});let n=this.computeMPBarWidth();C("enemyMPProgression",{width:`${n}%`})}}async multiAttack(e){d("enemyMove",{textContent:`${v(e)}Hit`});for(let n=0;n<e&&await this.checkMoveUse();n++)await this.attack(!0),await Me(this.attackRate/(1+e)*1e3)}async attack(e=!1){let n=this.computeBaseDamageSent();await fe.takeDamage(n),e||d("enemyMove",{textContent:"Attack"})}async doNothing(){d("enemyMove",{textContent:"Nothing"})}async heal(){this.currStats.HP+=this.baseStats.HP*(.5+.5*this.level/99),this.currStats.HP=Math.min(this.currStats.HP,this.baseStats.HP),d("enemyMove",{textContent:"Heal"}),this.updateHTML("Damage")}async checkMoveUse(){return fe.currStats.HP>0&&this.currStats.HP>0}};var nt=class extends Y{constructor(e,n){super(e,n);this.enemyType="Aggressive";this.variantSpecificHTML("Initialize")}async enemyAI(){let e=Math.random();e<.25&&this.currStats.HP/this.baseStats.HP<.22&&this.currStats.MP>=2?(await this.heal(),this.currStats.MP-=2,this.updateHTML("Damage"),this.updateHTML("Ability")):e<.33&&this.currStats.MP>=1?(this.currStats.MP-=1,this.updateHTML("Ability"),await this.multiAttack(2)):e<.5&&this.currStats.MP>=2?(this.currStats.MP-=2,this.updateHTML("Ability"),await this.multiAttack(12)):await this.attack()}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var at=class extends Y{constructor(e,n){super(e,n);this.enemyType="BOSS";this.firstAttack=!0,this.usedRage=!1,this.usedEmpowerment=!1,this.variantSpecificHTML("Initialize")}async enemyAI(){let e=Math.random();if(this.firstAttack){this.empower(),this.updateHTML("StatChange"),this.updateHTML("Ability"),d("enemyMove",{textContent:"EMPOWER"}),this.firstAttack=!1,this.usedEmpowerment=!0;return}if(!this.usedRage&&this.currStats.HP/this.baseStats.HP<.5){this.rage(),this.updateHTML("StatChange"),this.updateHTML("Ability"),d("enemyMove",{textContent:"RAGE"}),this.usedRage=!0;return}(e<.05||e<.3&&this.currStats.HP/this.baseStats.HP<.05)&&this.currStats.MP>=2?(await this.heal(),this.currStats.MP-=2,this.updateHTML("Damage"),this.updateHTML("Ability")):e<.75&&this.currStats.MP>=4?(this.currStats.MP-=4,this.updateHTML("Ability"),await this.multiAttack(5)):await this.attack()}empower(){this.currStats.ATK=Math.floor(1.3*this.currStats.ATK+2),this.currStats.STR=Math.floor(1.5*this.currStats.STR+2),this.currStats.CRITCHANCE+=25,this.currStats.CRITDAMAGE=Math.floor(1.4*this.currStats.CRITDAMAGE)}rage(){this.currStats.ATK=Math.floor(1.5*this.currStats.ATK),this.currStats.STR=Math.floor(1.8*this.currStats.STR),this.currStats.CRITCHANCE+=75,this.currStats.CRITDAMAGE=Math.floor(1.5*this.currStats.CRITDAMAGE),this.currStats.HP=this.baseStats.HP*(.75+.25*this.level/99)}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var ot=class extends Y{constructor(e,n){super(e,n);this.enemyType="Defensive";this.variantSpecificHTML("Initialize")}async enemyAI(){let e=Math.random();(e<.1||e<.25&&this.currStats.HP/this.baseStats.HP<.25)&&this.currStats.MP>=2?(this.currStats.MP-=2,await this.heal(),this.updateHTML("Damage"),this.updateHTML("Ability")):e<.375&&this.currStats.MP>=1?(this.currStats.MP-=1,this.updateHTML("Ability"),await this.multiAttack(2)):e<.625&&this.currStats.MP>=1?(this.currStats.MP-=1,this.updateHTML("Ability"),await this.defenseUp(),this.updateHTML("StatChange")):await this.attack()}async defenseUp(){this.currStats.DEF+=.01*this.currStats.DEF+1,this.currStats.DEF=Math.floor(this.currStats.DEF),d("enemyMove",{textContent:"DefenseUP"})}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var it=class extends Y{constructor(e,n){super(e,n);this.enemyType="Healer";this.variantSpecificHTML("Initialize")}async enemyAI(){let e=Math.random();(e<.333||e<.5&&this.currStats.HP/this.baseStats.HP<.25)&&this.currStats.MP>=2?(await this.heal(),this.currStats.MP-=2,this.updateHTML("Ability")):e<.375&&this.currStats.MP>=1?(this.currStats.MP-=1,this.updateHTML("Ability"),await this.multiAttack(2)):await this.attack()}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var st=class extends Y{constructor(e,n){super(e,n);this.enemyType="Idle";this.variantSpecificHTML("Initialize")}async enemyAI(){await this.doNothing()}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var ct=class extends Y{constructor(e,n){super(e,n);this.enemyType="Random";this.variantSpecificHTML("Initialize")}async enemyAI(){let e=Math.random();e<.125&&this.currStats.MP>=2?(await this.heal(),this.currStats.MP-=2,this.updateHTML("Damage"),this.updateHTML("Ability")):e<.25&&this.currStats.MP>=1?(this.currStats.MP-=1,this.updateHTML("Ability"),await this.multiAttack(2)):e<.375&&this.currStats.MP>=2?(this.currStats.MP-=2,this.updateHTML("Ability"),await this.multiAttack(3)):e<.75?await this.attack():await this.doNothing()}variantSpecificHTML(e){e==="Initialize"&&d("enemyName",{textContent:`${this.enemyType} Training Dummy Lv${v(this.level)}`})}};var ca={HP:20,MP:99,ATK:2,STR:0,DEF:0,ARMOR:0,CRITCHANCE:5,CRITDAMAGE:144},ua={HP:200,MP:120,ATK:1,STR:1,DEF:1,ARMOR:1,CRITCHANCE:25,CRITDAMAGE:150},fa={HP:50,MP:12,ATK:1,STR:0,DEF:30,ARMOR:1,CRITCHANCE:5,CRITDAMAGE:125},la={HP:35,MP:24,ATK:1,STR:0,DEF:10,ARMOR:0,CRITCHANCE:0,CRITDAMAGE:100},ma={HP:50,MP:1,ATK:0,STR:0,DEF:0,ARMOR:0,CRITCHANCE:0,CRITDAMAGE:100},da={HP:30,MP:25,ATK:1,STR:1,DEF:1,ARMOR:1,CRITCHANCE:30,CRITDAMAGE:125},ee,pe=()=>{let r=Math.random();r<=.05?ee=new st(ma,1):r<=.6?ee=new nt(ca,1.5):r<=.625?ee=new ot(fa,1):r<=.65?ee=new it(la,1):r<=.7?ee=new ct(da,1):ee=new at(ua,2)};var le=r=>{C("innerTesting",{border:"none"}),C("mainTab",{display:"none"}),C("upgradeTab",{display:"none"}),C("talentsTab",{display:"none"}),C("duelingTab",{display:"none"}),r==="Main"?C("mainTab",{display:"block"}):r==="Upgrades"?C("upgradeTab",{display:"block"}):r==="Talents"?C("talentsTab",{display:"block"}):r==="Dueling"&&(C("duelingTab",{display:"block"}),C("innerTesting",{border:"2px solid grey"}))},Be=(r,e)=>{e?C("progression",{backgroundColor:"gold"}):C("progression",{backgroundColor:"turquoise"}),setTimeout(()=>{C("progression",{backgroundColor:ve(r)})},500),d("refresh-crit-counter",{textContent:v(r.criticalHitsThisRefresh)}),d("refresh-crit-fragments",{textContent:v(100*r.criticalHitsThisRefresh*r.coinUpgrades.barAgitation.upgradeEffect(),2)}),r.barFragments.updateHTML()},Ne=r=>{C("progression",{backgroundColor:"cyan"}),setTimeout(()=>{C("progression",{backgroundColor:ve(r)})},1e3),d("coinWorth",{textContent:`Worth ${v(r.coinValueCache)} coins`}),r.coinValueCache>0?C("coinWorth",{color:"gold"}):C("coinWorth",{color:"grey"}),d("refresh-crit-counter",{textContent:v(r.criticalHitsThisRefresh)}),d("refresh-counter",{textContent:v(r.refreshCount)})};var ha=10,ke=0,ut=0,Le=r=>{let e=0;return e+=ha*Math.pow(r.barLevel+1,2),e*=Math.min(1,(r.barLevel+20)/40),e*=Math.max(1,1+(r.barLevel-20)/10),r.barLevel>40&&(e*=Math.pow(2,1/10*(r.barLevel-40))),r.barLevel>100&&(e*=Math.pow(2,1/10*(r.barLevel-100))),r.barLevel>200&&(e*=Math.pow(2,1/10*(r.barLevel-200))),r.barLevel%5===0&&(e*=Math.max(1,1/2*r.barLevel/10)),e},pa=r=>{let e=0;return r.barLevel>=10&&(e+=1-Math.pow(Math.E,-r.barLevel/200)),e>=.9999?1e4:1/(1-e)},va=r=>{let e=pa(r);return Math.max(1,e*(1-r.barEXP/r.barTNL))},ft=(r,e)=>{if(r==null)return;let n=1;if(n+=e.coinUpgrades.barSpeed.upgradeEffect(),n*=e.barFragments.unspentBonus(),n*=Math.pow(1+e.coinUpgrades.barMomentum.upgradeEffect(),Math.sqrt(100*Math.min(1,e.barEXP/e.barTNL))),n/=va(e),n*=e.talents.barSpeed.talentEffect(),n*=Math.pow(1+e.coinUpgrades.barEmpowerment.upgradeEffect(),e.barLevel),Math.random()<ht(e)){let E=!1;n*=e.coinUpgrades.barVibration.upgradeEffect(),e.talents.barCriticalChance.gainEXP(r),e.criticalHits+=1,e.criticalHitsThisRefresh+=1,Math.random()<e.coinUpgrades.barResonance.upgradeEffect()&&(n*=3,e.coins.gain(Math.floor(e.barLevel/5)+3),E=!0),Be(e,E)}let f=n*r;e.barEXP+=f,ke+=f,d("perSecCurr",{textContent:`+${v(ke,2)} this sec`})},me=(r,e)=>Math.min(100,.1*Math.floor(1e3*r/e)),be=r=>{C("progression",{width:`${r}%`})},ve=r=>{if(r.barLevel%5===0)return r.barLevel>=320?"#FF0000":`#${(128+4*Math.floor(r.barLevel/10)).toString(16).padStart(2,"0")}0000`;if(r.barLevel>=128)return"#FFFFFF";let e=(128+r.barLevel).toString(16).padStart(2,"0"),n=(2*r.barLevel).toString(16).padStart(2,"0"),u=(128+r.barLevel).toString(16).padStart(2,"0");return`#${e}${n}${u}`},lt=r=>{r.coins.gain(r.coinValueCache),r.coinValueCache=dt(r),r.barEXP-=r.barTNL,r.barLevel+=1,r.barLevel>r.highestBarLevel&&(r.highestBarLevel=r.barLevel);let e=ve(r);C("progression",{backgroundColor:e}),r.barTNL=Le(r),r.barEXP/=10,r.barEXP=Math.min(r.barEXP,Math.floor(r.barTNL/10));let n=me(r.barEXP,r.barTNL);be(n),d("coinWorth",{textContent:`Worth ${v(r.coinValueCache)} coins`}),r.barFragments.updateHTML(),r.barLevel===20&&(r.talents.barCriticalChance.updateHTML("Level20"),r.talents.barSpeed.updateHTML("Level20"))},mt=r=>{d("level",{textContent:`Level: ${r.barLevel}`}),d("exp",{textContent:`EXP: ${v(r.barEXP)}/${v(r.barTNL)}`})},Rr=r=>{ut=ke,ke=0,d("perSecPrev",{textContent:`+${v(ut,2)} prev sec`}),r.talents.barCriticalChance.updateHTML("Time"),r.talents.barSpeed.gainEXP(ut),r.talents.barSpeed.updateHTML("Time"),r.talents.coinGain.updateHTML("Time")},dt=r=>{let e=0,n=1+r.barLevel;n>r.highestBarLevel&&(e+=3),n%5===0&&(e+=Math.floor(n/5)+3,Math.random()<.5&&n>25&&(e=0)),n%10===0&&(e+=Math.floor(n/2)),n%50===0&&(e+=Math.floor(n/2)),n%100===0&&(e+=Math.floor(n)),e>100&&(e=10*Math.pow(e,1/2)),e*=1+r.talents.coinGain.talentEffect();let u=e-Math.floor(e);Math.random()<u&&(e+=1),e=Math.floor(e);let f=I("coinWorth");return f.style.color=e>0?"gold":"grey",e},ht=r=>r.coinUpgrades.barReverberation.upgradeEffect()+r.talents.barCriticalChance.talentEffect();var Pe=class{constructor(e=0,n){this.amount=e;this.player=n;this.amount=e,this.updateHTML()}spend(e){this.amount>=e&&(this.amount-=e,this.updateHTML())}gain(e){this.amount+=e,this.updateHTML(),this.updateOnGain(e)}set(e){this.amount=e,this.updateHTML()}valueOf(){return{amount:this.amount}}};var pt=class extends Pe{updateHTML(){d("gold-amount",{textContent:v(this.amount)})}updateOnGain(e){e>0&&this.player.talents.coinGain.gainEXP(e)}};var wr="coins",vt=(r,e)=>{var u,f;let n=(u=x(r,wr))!=null?u:x(e,wr);return new pt((f=n==null?void 0:n.amount)!=null?f:0,e)};var bt=class extends Pe{updateHTML(){d("fragment-amount",{textContent:v(this.amount)}),d("fragment-bonus",{textContent:v(this.amount)}),d("fragment-gain",{textContent:v(this.getAmountOnRefresh())})}getAmountOnRefresh(){let e=this.player.barLevel,n=100*Math.pow(1.07,-5);return n*=Math.pow(1.07,e),n*=Math.pow(3,Math.floor(e/100)),n*=1+this.player.criticalHitsThisRefresh*this.player.coinUpgrades.barAgitation.upgradeEffect(),n*=1+this.player.coinUpgrades.barReinforcement.upgradeEffect()*this.player.barLevel,Math.floor(n)}unspentBonus(){return 1+1/100*this.amount}updateOnGain(){}};var Ar="barFragments",gt=(r,e)=>{var u,f;let n=(u=x(r,Ar))!=null?u:x(e,Ar);return new bt((f=n==null?void 0:n.amount)!=null?f:0,e)};var xe=class{constructor(e,n,u){this.level=e;this.cost=n;this.player=u}};var te=class extends xe{constructor(e,n,u){super(e,n,u);this.updateHTML()}capLevel(){this.maxLevel!==-1&&(this.level=Math.min(this.maxLevel,this.level))}purchaseLevels(e,n){n.shiftKey&&(e=-1,e=Math.floor(this.player.coins.amount/this.cost)),this.maxLevel!==-1&&(e=Math.min(e,this.maxLevel-this.level)),this.cost*e<=this.player.coins.amount&&(this.player.coins.spend(this.cost*e),this.level+=e,this.updateHTML())}valueOf(){return{level:this.level,cost:this.cost,maxLevel:this.maxLevel}}},W={barSpeed:1,barMomentum:10,barReverberation:25,barVibration:50,barAgitation:1e4,barAdoption:250,barEmpowerment:1e4,barReinforcement:2e4,barResonance:2e3},yt=class extends te{constructor(){super(...arguments);this.maxLevel=-1}upgradeEffect(){return 4*this.level/100+.06*Math.min(90,this.level)}updateHTML(){d("coin-bar-speed-effect",{textContent:`+${v(this.upgradeEffect(),2)} Progress Per Second`}),d("coin-bar-speed-name",{textContent:`Bar Speed ${v(this.level)}`})}},Et=class extends te{constructor(e,n,u){super(e,n,u);this.expoDivisor=400;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.maxLevel=100*Math.round(this.maxLevel/100),this.capLevel(),this.updateHTML()}upgradeEffect(){return this.maxLevel===this.level?Math.pow(100,1/10)-1:(.45*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+1/200*Math.min(10,this.level))*((Math.pow(100,1/10)-1)/.5)}updateHTML(){d("coin-bar-momentum-effect",{textContent:`Up to ${v(Math.pow(1+this.upgradeEffect(),10),2)}x Progress Speed based on fill%`}),this.level===this.maxLevel?(d("coin-bar-momentum-name",{textContent:"Bar Momentum [MAX LEVEL]"}),C("coin-bar-momentum-name",{color:"orchid"})):d("coin-bar-momentum-name",{textContent:`Bar Momentum ${v(this.level)}/${v(this.maxLevel)}`})}},Tt=class extends te{constructor(e,n,u){super(e,n,u);this.expoDivisor=100;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.maxLevel=100*Math.round(this.maxLevel/100),this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level===this.maxLevel?.01:.009*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+2e-4*Math.min(5,this.level)}updateHTML(){d("coin-bar-reverberation-effect",{textContent:`+${v(100*this.upgradeEffect(),2)}% chance to have a CRITICAL TICK`}),this.level===this.maxLevel?(d("coin-bar-reverberation-name",{textContent:"Bar Reverberation [MAX LEVEL]"}),C("coin-bar-reverberation-name",{color:"orchid"})):d("coin-bar-reverberation-name",{textContent:`Bar Reverberation ${v(this.level)}/${v(this.maxLevel)}`})}},St=class extends te{constructor(e,n,u){super(e,n,u);this.expoDivisor=170;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.maxLevel=100*Math.round(this.maxLevel/100),this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level===this.maxLevel?2e3:100+1700*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+20*Math.min(10,this.level)}updateHTML(){d("coin-bar-vibration-effect",{textContent:`CRITICAL TICKS fill up the bar ${v(this.upgradeEffect(),2)}x faster`}),this.level===this.maxLevel?(d("coin-bar-vibration-name",{textContent:"Bar Vibration [MAX LEVEL]"}),C("coin-bar-vibration-name",{color:"orchid"})):d("coin-bar-vibration-name",{textContent:`Bar Vibration ${v(this.level)}/${v(this.maxLevel)}`})}},Mt=class extends te{constructor(e,n,u){super(e,n,u);this.maxLevel=-1;this.updateHTML()}upgradeEffect(){return this.level/500}updateHTML(){d("coin-bar-agitation-effect",{textContent:`+${v(100*this.upgradeEffect(),2)}% Bar Fragments per CRIT.`}),d("coin-bar-agitation-name",{textContent:`Bar Agitation ${v(this.level)}`})}},Lt=class extends te{constructor(e,n,u){super(e,n,u);this.maxLevel=200;this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level/100}updateHTML(){d("coin-bar-adoption-effect",{textContent:`+${v(100*this.upgradeEffect())}% Talent EXP`}),this.level===this.maxLevel?(d("coin-bar-adoption-name",{textContent:"Bar Adoption [MAX LEVEL]"}),C("coin-bar-adoption-name",{color:"orchid"})):d("coin-bar-adoption-name",{textContent:`Bar Adoption ${v(this.level)}/${v(this.maxLevel)}`})}},Pt=class extends te{constructor(e,n,u){super(e,n,u);this.maxLevel=100;this.capLevel(),this.updateHTML()}upgradeEffect(){return .02*this.level/100}updateHTML(){d("coin-bar-empowerment-effect",{textContent:`+${v(100*this.upgradeEffect(),2)}% Progress Speed per bar level: (1+x)^(level)`}),this.level===this.maxLevel?(d("coin-bar-empowerment-name",{textContent:"Bar Empowerment [MAX LEVEL]"}),C("coin-bar-empowerment-name",{color:"orchid"})):d("coin-bar-empowerment-name",{textContent:`Bar Empowerment ${v(this.level)}/${v(this.maxLevel)}`})}},xt=class extends te{constructor(e,n,u){super(e,n,u);this.maxLevel=-1;this.updateHTML()}upgradeEffect(){return this.level/1e3}updateHTML(){d("coin-bar-reinforcement-effect",{textContent:`+${v(100*this.upgradeEffect(),2)}% Bar Fragments per bar level (1 + x * level)`}),d("coin-bar-reinforcement-name",{textContent:`Bar Reinforcement ${v(this.level)}`})}},Ct=class extends te{constructor(e,n,u){super(e,n,u);this.expoDivisor=500;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.maxLevel=100*Math.round(this.maxLevel/100),this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level===this.maxLevel?1:1-Math.pow(Math.E,-this.level/this.expoDivisor)}updateHTML(){d("coin-bar-resonance-effect",{textContent:`On CRIT, ${v(100*this.upgradeEffect(),2)}% chance of SUPER
                             CRIT (3x damage and earn coins)`}),this.level===this.maxLevel?(d("coin-bar-resonance-name",{textContent:"Bar Resonance [MAX LEVEL]"}),C("coin-bar-resonance-name",{color:"orchid"})):d("coin-bar-resonance-name",{textContent:`Bar Resonance ${v(this.level)}/${v(this.maxLevel)}`})}};var Ir="coinUpgrades.barSpeed",Rt=(r,e)=>{var u,f;let n=(u=x(r,Ir))!=null?u:x(e,Ir);return new yt((f=n==null?void 0:n.level)!=null?f:0,W.barSpeed,e)};var Hr="coinUpgrades.barMomentum",wt=(r,e)=>{var u,f;let n=(u=x(r,Hr))!=null?u:x(e,Hr);return new Et((f=n==null?void 0:n.level)!=null?f:0,W.barMomentum,e)};var Dr="coinUpgrades.barReverberation",At=(r,e)=>{var u,f;let n=(u=x(r,Dr))!=null?u:x(e,Dr);return new Tt((f=n==null?void 0:n.level)!=null?f:0,W.barReverberation,e)};var _r="coinUpgrades.barVibration",It=(r,e)=>{var u,f;let n=(u=x(r,_r))!=null?u:x(e,_r);return new St((f=n==null?void 0:n.level)!=null?f:0,W.barVibration,e)};var Br="coinUpgrades.barAgitation",Ht=(r,e)=>{var u,f;let n=(u=x(r,Br))!=null?u:x(e,Br);return new Mt((f=n==null?void 0:n.level)!=null?f:0,W.barAgitation,e)};var Nr="coinUpgrades.barAdoption",Dt=(r,e)=>{var u,f;let n=(u=x(r,Nr))!=null?u:x(e,Nr);return new Lt((f=n==null?void 0:n.level)!=null?f:0,W.barAdoption,e)};var kr="coinUpgrades.barEmpowerment",_t=(r,e)=>{var u,f;let n=(u=x(r,kr))!=null?u:x(e,kr);return new Pt((f=n==null?void 0:n.level)!=null?f:0,W.barEmpowerment,e)};var Ur="coinUpgrades.barReinforcement",Bt=(r,e)=>{var u,f;let n=(u=x(r,Ur))!=null?u:x(e,Ur);return new xt((f=n==null?void 0:n.level)!=null?f:0,W.barReinforcement,e)};var $r="coinUpgrades.barResonance",Nt=(r,e)=>{var u,f;let n=(u=x(r,$r))!=null?u:x(e,$r);return new Ct((f=n==null?void 0:n.level)!=null?f:0,W.barResonance,e)};var Ue=(r,e)=>{if(r==="Refresh"&&e.barLevel>=5){if(e.refreshTime<Ce)return void j(`Currently, refreshes have a ${v(Ce)} second cooldown. Sorry!`);e.barFragments.set(e.barFragments.getAmountOnRefresh()),e.barEXP=0,e.barLevel=0,e.barTNL=Le(e),be(me(e.barEXP,e.barTNL)),e.barFragments.updateHTML(),e.talents.barCriticalChance.convertToPerm(),e.talents.barCriticalChance.updateHTML("Initialize"),e.talents.barSpeed.convertToPerm(),e.talents.barSpeed.updateHTML("Initialize"),e.talents.coinGain.convertToPerm(),e.talents.coinGain.updateHTML("Initialize"),e.refreshCount+=1,e.refreshTime=0,e.criticalHitsThisRefresh=0,e.coinValueCache=dt(e),Be(e,!1),Ne(e)}else return void j("You cannot refresh yet. Get to level 5 lol")};var kt=r=>r.barLevel>=20,$e=class extends xe{constructor(e,n,u,f,E,T){super(e,n,T);this.investedFragments=u,this.permLevel=f,this.currEXP=E,this.currTNL=this.calculateTNL()}calculateTNL(){let e=Pr(this.cost,this.level,this.level+1,2),n=[50,100,200,500,1e3,2e3,5e3,1e4];for(let u of n)this.level>=u&&(e*=2);return e}setEXP(e){this.currEXP=e,this.updateHTML("GainEXP")}globalTalentEXPMultipliers(){let e=1;return e*=this.sacrificeBoost(),e*=1+this.player.coinUpgrades.barAdoption.upgradeEffect(),e}gainEXP(e){if(!kt(this.player))return;let n=this.calculateEXPGain(e);this.currEXP+=n,this.currEXP>=this.currTNL&&this.levelUp(),this.updateHTML("GainEXP")}subEXP(e){!kt(this.player)||(this.currEXP-=e)}levelUp(){let e=0;for(;this.currEXP>=this.currTNL&&!(e>=10);)this.level+=1,this.subEXP(this.currTNL),this.currTNL=this.calculateTNL(),e++;this.updateHTML("LevelUp")}computePermLevelGain(e){let n=0;return n+=Math.sqrt(e),n*=Math.min(4,Math.pow(this.player.refreshTime/300,2)),n=Math.min(e,n),Math.floor(n)}convertToPerm(){this.permLevel+=this.computePermLevelGain(this.level),this.level=0,this.setEXP(0),this.currTNL=this.calculateTNL(),this.updateHTML("PermLevelUp")}getBarWidth(){return Math.min(100,100*this.currEXP/this.currTNL)}sacrificeBoost(){return 1+1/100*Math.pow(Math.log2(1+this.investedFragments/4),2)}async sacrificeFragments(){if(this.player.barFragments.amount<1e3)return void j("You cannot sacrifice your bar fragments until you have at least 1,000 of them.");if(this.player.barFragments.amount<=this.investedFragments)return void j(`This bar needs more fragments than you can invest. You need ${v(this.investedFragments)}.`);await De(`You will sacrifice ${v(this.player.barFragments.amount-this.investedFragments)} Bar Fragments to increase EXP gain for this bar. Will you? (automatically performs a refresh, setting your fragments to 0)`)&&(this.investedFragments=this.player.barFragments.amount,this.player.refreshTime+=Ce,Ue("Refresh",this.player),this.player.barFragments.set(0),this.updateHTML("Sacrifice"))}updateHTML(e){if(this.idHTML!==void 0){if(e==="Initialize"||e==="GainEXP"||e==="LevelUp"||e==="PermLevelUp"){d(`talent${this.idHTML}EXP`,{textContent:`EXP: ${v(this.currEXP)}/${v(this.currTNL)}`});let n=`${this.getBarWidth()}%`;C(`talent${this.idHTML}Progression`,{width:n})}(e==="Initialize"||e==="LevelUp"||e==="PermLevelUp")&&d(`talent${this.idHTML}TempLevel`,{textContent:`Level this run: ${v(this.level)}`}),(e==="Initialize"||e==="PermLevelUp")&&d(`talent${this.idHTML}PermLevel`,{textContent:`Banked levels: ${v(this.permLevel)}`}),(e==="Initialize"||e==="Time"||e==="LevelUp")&&d(`talent${this.idHTML}PermGain`,{textContent:`Banked on reset: +${v(this.computePermLevelGain(this.level))}`}),(e==="Initialize"||e==="LevelUp"||e==="PermLevelUp"||e==="Level20")&&d(`talent${this.idHTML}Effect`,{textContent:this.displayEffect()}),(e==="Initialize"||e==="Sacrifice")&&(d(`talent${this.idHTML}SacrificeAmount`,{textContent:v(this.investedFragments)}),d(`talent${this.idHTML}SacrificeMultiplier`,{textContent:v(this.sacrificeBoost(),3)}))}}valueOf(){return{level:this.level,cost:this.cost,investedFragments:this.investedFragments,permLevel:this.permLevel,currEXP:this.currEXP,idHTML:this.idHTML}}},ge={talentCriticalChance:10,talentProgressSpeed:10,talentCoinGain:1e3},Ut=class extends $e{constructor(e,n,u,f,E,T){super(e,n,u,f,E,T);this.idHTML="CriticalChance";this.updateHTML("Initialize")}calculateEXPGain(e){let n=5;return n*=e*1e3/Re,n*=this.player.barLevel/10-1,n*=this.globalTalentEXPMultipliers(),n}talentEffect(){return kt(this.player)?.0025*(1-Math.pow(Math.E,-this.level/2500))+.0025*Math.min(250,this.level)/250+.0025*(1-Math.pow(Math.E,-this.permLevel/4e3))+.0025*Math.min(500,this.level)/500:0}displayEffect(){return`+${v(100*this.talentEffect(),3)}% chance of CRITICAL TICK`}},$t=class extends $e{constructor(e,n,u,f,E,T){super(e,n,u,f,E,T);this.idHTML="ProgressSpeed";this.updateHTML("Initialize")}calculateEXPGain(e){let n=Math.log10(1+e);return n*=this.player.barLevel/10-1,n*=this.globalTalentEXPMultipliers(),n}talentEffect(){return(1+this.level/25)*(1+this.permLevel/50)}displayEffect(){return`Progress Speed +${v(100*(this.talentEffect()-1),2)}%`}},Ft=class extends $e{constructor(e,n,u,f,E,T){super(e,n,u,f,E,T);this.idHTML="CoinGain";this.updateHTML("Initialize")}calculateEXPGain(e){let n=2+Math.floor(Math.pow(e,2)/100+4*e);return n*=this.globalTalentEXPMultipliers(),n}talentEffect(){return Math.min(.4,this.level/1e3)+Math.min(.4,this.permLevel/2e3)+.2*(this.level*25+this.permLevel)/(2500+this.level*25+this.permLevel)+1*(this.level*25+this.permLevel)/(5e4+this.level*25+this.permLevel)}displayEffect(){return`Progress bar grants +${v(100*this.talentEffect(),2)}% coins!`}};var Fr="talents.barCriticalChance",Ot=(r,e)=>{var u,f,E,T,w;let n=(u=x(r,Fr))!=null?u:x(e,Fr);return new Ut((f=n==null?void 0:n.level)!=null?f:0,ge.talentCriticalChance,(E=n==null?void 0:n.investedFragments)!=null?E:0,(T=n==null?void 0:n.permLevel)!=null?T:0,(w=n==null?void 0:n.currEXP)!=null?w:0,e)};var Or="talents.barSpeed",Gt=(r,e)=>{var u,f,E,T,w;let n=(u=x(r,Or))!=null?u:x(e,Or);return new $t((f=n==null?void 0:n.level)!=null?f:0,ge.talentProgressSpeed,(E=n==null?void 0:n.investedFragments)!=null?E:0,(T=n==null?void 0:n.permLevel)!=null?T:0,(w=n==null?void 0:n.currEXP)!=null?w:0,e)};var Gr="talents.coinGain",Xt=(r,e)=>{var u,f,E,T,w;let n=(u=x(r,Gr))!=null?u:x(e,Gr);return new Ft((f=n==null?void 0:n.level)!=null?f:0,ge.talentCoinGain,(E=n==null?void 0:n.investedFragments)!=null?E:0,(T=n==null?void 0:n.permLevel)!=null?T:0,(w=n==null?void 0:n.currEXP)!=null?w:0,e)};var M={firstPlayed:new Date,barEXP:0,barTNL:0,totalEXP:0,barLevel:0,highestBarLevel:0,refreshCount:0,refreshTime:0,criticalHits:0,criticalHitsThisRefresh:0,coinValueCache:0},Wr=Object.assign({},M),ga=async r=>{var u;let e=gr(oe({},r),{coins:r.coins.valueOf(),coinUpgrades:{barSpeed:r.coinUpgrades.barSpeed.valueOf(),barMomentum:r.coinUpgrades.barMomentum.valueOf(),barReverberation:r.coinUpgrades.barReverberation.valueOf(),barVibration:r.coinUpgrades.barVibration.valueOf(),barAgitation:r.coinUpgrades.barAgitation.valueOf(),barAdoption:r.coinUpgrades.barAdoption.valueOf(),barEmpowerment:r.coinUpgrades.barEmpowerment.valueOf(),barReinforcement:r.coinUpgrades.barReinforcement.valueOf(),barResonance:r.coinUpgrades.barResonance.valueOf()},talents:{barCriticalChance:r.talents.barCriticalChance.valueOf(),barSpeed:r.talents.barSpeed.valueOf(),coinGain:r.talents.coinGain.valueOf()},barFragments:r.barFragments.valueOf()}),n=btoa(JSON.stringify(e));if(await Oe.default.setItem("UPBSave",n),typeof((u=navigator.storage)==null?void 0:u.estimate)=="function"){let{usage:f,quota:E}=await navigator.storage.estimate();E&&f&&f/E*100>95&&j("You are very close to running out of space on this computer which may cause your save to getautomatically deleted soon! Clear some other site's data (and tell Khafra that this works please)!")}},Xr=new Map([["coins",vt],["coinUpgrades.barSpeed",Rt],["coinUpgrades.barMomentum",wt],["coinUpgrades.barReverberation",At],["coinUpgrades.barVibration",It],["coinUpgrades.barAgitation",Ht],["coinUpgrades.barAdoption",Dt],["coinUpgrades.barEmpowerment",_t],["coinUpgrades.barReinforcement",Bt],["coinUpgrades.barResonance",Nt],["talents.barCriticalChance",Ot],["talents.barSpeed",Gt],["talents.coinGain",Xt],["barFragments",gt]]),ya=async()=>{let r=await Oe.default.getItem("UPBSave"),e=r?JSON.parse(atob(r)):null;if(e!==null){let n=Object.keys(e);for(let u of n)u in Wr&&(Xr.has(u)||Object.defineProperty(M,u,{value:e[u]}))}for(let[n,u]of Xr)Tr(M,n,u(e!=null?e:M,M))},we=new Set,Fe=new Proxy(setInterval,{apply(r,e,n){let u=r.apply(e,n);return we.add(u),u}}),Ea=new Proxy(clearInterval,{apply(r,e,n){let u=n[0];return we.has(u)&&we.delete(u),r.apply(e,n)}});window.addEventListener("pagehide",()=>{window.scrollTo(0,0)});var Wt=0,zt=0,Re=24,Ta=6e4,Vt=async()=>{for(let r of we)Ea(r);we.clear(),await ya(),M.barTNL=Le(M),Object.defineProperty(window,"player",{value:M}),be(me(M.barEXP,M.barTNL)),M.barFragments.updateHTML(),le("Main"),C("progression",{backgroundColor:ve(M)}),d("coinWorth",{textContent:`Worth ${v(M.coinValueCache)} coins`}),M.coinValueCache&&C("coinWorth",{color:"gold"}),Wt=performance.now(),zt=performance.now(),Fe(Sa,1e3/Re),Fe(Ma,1e3/Re),Fe(Rr,1e3,M),Fe(ga,Ta,M),pe()},zr=async()=>{if(await De("Are you SURE you want to reset the game?")===!1)return j("OK, the game hasn't been reset!");await Oe.default.removeItem("UPBSave");let e=Object.keys(M);for(let n of e){if(typeof M[n]=="object"){delete M[n];continue}Object.defineProperty(M,n,{value:Wr[n]})}await Vt()},Sa=()=>{let e=performance.now()-Wt;Kt(e/1e3),Wt+=e},Ma=async()=>{let e=performance.now()-zt;zt+=e,await ee.generateAttacks(e/1e3),await fe.decreaseDelay(e/1e3)},Kt=r=>{let e=r;if(e>5){let u=ht(M),f=Re*u*5,E=Math.floor(f),T=f-E,w=f*M.coinUpgrades.barResonance.upgradeEffect(),L=Math.floor(w),B=w-L;for(;e>5;){let k=Math.random(),V=0;k<T&&(V=1);let y=E+V;M.criticalHitsThisRefresh+=y;let P=Math.random(),U=0;P<B&&(U+=1);let $=L+U;for(;$>0;)M.coins.gain(Math.floor(M.barLevel/5)+3),$-=1;ft(5,M),e-=5,me(M.barEXP,M.barTNL)>=100&&lt(M),mt(M)}}ft(e,M),M.refreshTime+=r,d("refresh-timer",{textContent:`${v(M.refreshTime,2)}s`});let n=me(M.barEXP,M.barTNL);n<100?be(n):lt(M),mt(M)},Ce=60;var Vr=r=>{I("main-tab-nav").addEventListener("click",()=>le("Main")),I("upgrade-tab-nav").addEventListener("click",()=>le("Upgrades")),I("talent-tab-nav").addEventListener("click",()=>le("Talents")),I("dueling-tab-nav").addEventListener("click",()=>le("Dueling")),I("buy-coin-bar-speed").addEventListener("click",e=>r.coinUpgrades.barSpeed.purchaseLevels(1,e)),I("buy-coin-bar-momentum").addEventListener("click",e=>r.coinUpgrades.barMomentum.purchaseLevels(1,e)),I("buy-coin-bar-reverberation").addEventListener("click",e=>r.coinUpgrades.barReverberation.purchaseLevels(1,e)),I("buy-coin-bar-vibration").addEventListener("click",e=>r.coinUpgrades.barVibration.purchaseLevels(1,e)),I("buy-coin-bar-agitation").addEventListener("click",e=>r.coinUpgrades.barAgitation.purchaseLevels(1,e)),I("buy-coin-bar-adoption").addEventListener("click",e=>r.coinUpgrades.barAdoption.purchaseLevels(1,e)),I("buy-coin-bar-empowerment").addEventListener("click",e=>r.coinUpgrades.barEmpowerment.purchaseLevels(1,e)),I("buy-coin-bar-reinforcement").addEventListener("click",e=>r.coinUpgrades.barReinforcement.purchaseLevels(1,e)),I("buy-coin-bar-resonance").addEventListener("click",e=>r.coinUpgrades.barResonance.purchaseLevels(1,e)),I("buy-reset").addEventListener("click",()=>Ue("Refresh",r)),I("reset-game").addEventListener("click",()=>void zr()),I("simulate-time").addEventListener("click",()=>void Kt(3600)),I("talentCriticalChanceSacrifice").addEventListener("click",()=>void r.talents.barCriticalChance.sacrificeFragments()),I("talentProgressSpeedSacrifice").addEventListener("click",()=>void r.talents.barSpeed.sacrificeFragments()),I("talentCoinGainSacrifice").addEventListener("click",()=>void r.talents.coinGain.sacrificeFragments()),I("basicAttack").addEventListener("click",()=>void fe.attack()),I("autoAttack").addEventListener("click",()=>void Cr())};window.addEventListener("load",async()=>{var r,e;if(Vr(M),await Vt(),Ne(M),typeof((r=navigator.storage)==null?void 0:r.persist)=="function"&&typeof((e=navigator.storage)==null?void 0:e.persisted)=="function"){let n=await navigator.storage.persisted();n?console.log(`Storage is persistent! (persistent = ${n})`):await navigator.storage.persist()&&j("Data on this page is now persistent! If you do not know what this means, you can safely ignore it.")}});document.addEventListener("visibilitychange",()=>{document.visibilityState!=="hidden"&&(M.coins.updateHTML(),M.coinUpgrades.barMomentum.updateHTML(),M.coinUpgrades.barSpeed.updateHTML(),M.coinUpgrades.barReverberation.updateHTML(),M.coinUpgrades.barVibration.updateHTML(),M.coinUpgrades.barAgitation.updateHTML(),M.barFragments.updateHTML(),M.talents.barCriticalChance.updateHTML("Initialize"),M.talents.barSpeed.updateHTML("Initialize"),d("coinWorth",{textContent:`Worth ${v(M.coinValueCache)} coins`}),M.coinValueCache>0?C("coinWorth",{color:"gold"}):C("coinWorth",{color:"grey"}))});})();
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
//# sourceMappingURL=out.js.map
