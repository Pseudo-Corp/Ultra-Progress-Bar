(()=>{var ln=Object.create;var Me=Object.defineProperty,dn=Object.defineProperties,mn=Object.getOwnPropertyDescriptor,pn=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertyNames,Ht=Object.getOwnPropertySymbols,vn=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty,bn=Object.prototype.propertyIsEnumerable;var Ot=(n,r,i)=>r in n?Me(n,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[r]=i,Xt=(n,r)=>{for(var i in r||(r={}))Ft.call(r,i)&&Ot(n,i,r[i]);if(Ht)for(var i of Ht(r))bn.call(r,i)&&Ot(n,i,r[i]);return n},$t=(n,r)=>dn(n,pn(r)),gn=n=>Me(n,"__esModule",{value:!0});var ge=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(r,i)=>(typeof require!="undefined"?require:r)[i]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var yn=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var En=(n,r,i,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of hn(r))!Ft.call(n,h)&&(i||h!=="default")&&Me(n,h,{get:()=>r[h],enumerable:!(c=mn(r,h))||c.enumerable});return n},Ln=(n,r)=>En(gn(Me(n!=null?ln(vn(n)):{},"default",!r&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Vt=yn((Yt,Ve)=>{(function(n){if(typeof Yt=="object"&&typeof Ve<"u")Ve.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var r;typeof window<"u"?r=window:typeof global<"u"?r=global:typeof self<"u"?r=self:r=this,r.localforage=n()}})(function(){var n,r,i;return function c(h,E,y){function _(N,G){if(!E[N]){if(!h[N]){var b=typeof ge=="function"&&ge;if(!G&&b)return b(N,!0);if(L)return L(N,!0);var T=new Error("Cannot find module '"+N+"'");throw T.code="MODULE_NOT_FOUND",T}var O=E[N]={exports:{}};h[N][0].call(O.exports,function(X){var J=h[N][1][X];return _(J||X)},O,O.exports,c,h,E,y)}return E[N].exports}for(var L=typeof ge=="function"&&ge,A=0;A<y.length;A++)_(y[A]);return _}({1:[function(c,h,E){(function(y){"use strict";var _=y.MutationObserver||y.WebKitMutationObserver,L;if(_){var A=0,N=new _(X),G=y.document.createTextNode("");N.observe(G,{characterData:!0}),L=function(){G.data=A=++A%2}}else if(!y.setImmediate&&typeof y.MessageChannel<"u"){var b=new y.MessageChannel;b.port1.onmessage=X,L=function(){b.port2.postMessage(0)}}else"document"in y&&"onreadystatechange"in y.document.createElement("script")?L=function(){var $=y.document.createElement("script");$.onreadystatechange=function(){X(),$.onreadystatechange=null,$.parentNode.removeChild($),$=null},y.document.documentElement.appendChild($)}:L=function(){setTimeout(X,0)};var T,O=[];function X(){T=!0;for(var $,j,W=O.length;W;){for(j=O,O=[],$=-1;++$<W;)j[$]();W=O.length}T=!1}h.exports=J;function J($){O.push($)===1&&!T&&L()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(c,h,E){"use strict";var y=c(1);function _(){}var L={},A=["REJECTED"],N=["FULFILLED"],G=["PENDING"];h.exports=b;function b(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=G,this.queue=[],this.outcome=void 0,v!==_&&J(this,v)}b.prototype.catch=function(v){return this.then(null,v)},b.prototype.then=function(v,C){if(typeof v!="function"&&this.state===N||typeof C!="function"&&this.state===A)return this;var S=new this.constructor(_);if(this.state!==G){var B=this.state===N?v:C;O(S,B,this.outcome)}else this.queue.push(new T(S,v,C));return S};function T(v,C,S){this.promise=v,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}T.prototype.callFulfilled=function(v){L.resolve(this.promise,v)},T.prototype.otherCallFulfilled=function(v){O(this.promise,this.onFulfilled,v)},T.prototype.callRejected=function(v){L.reject(this.promise,v)},T.prototype.otherCallRejected=function(v){O(this.promise,this.onRejected,v)};function O(v,C,S){y(function(){var B;try{B=C(S)}catch(z){return L.reject(v,z)}B===v?L.reject(v,new TypeError("Cannot resolve promise with itself")):L.resolve(v,B)})}L.resolve=function(v,C){var S=$(X,C);if(S.status==="error")return L.reject(v,S.value);var B=S.value;if(B)J(v,B);else{v.state=N,v.outcome=C;for(var z=-1,Y=v.queue.length;++z<Y;)v.queue[z].callFulfilled(C)}return v},L.reject=function(v,C){v.state=A,v.outcome=C;for(var S=-1,B=v.queue.length;++S<B;)v.queue[S].callRejected(C);return v};function X(v){var C=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof C=="function")return function(){C.apply(v,arguments)}}function J(v,C){var S=!1;function B(K){S||(S=!0,L.reject(v,K))}function z(K){S||(S=!0,L.resolve(v,K))}function Y(){C(z,B)}var V=$(Y);V.status==="error"&&B(V.value)}function $(v,C){var S={};try{S.value=v(C),S.status="success"}catch(B){S.status="error",S.value=B}return S}b.resolve=j;function j(v){return v instanceof this?v:L.resolve(new this(_),v)}b.reject=W;function W(v){var C=new this(_);return L.reject(C,v)}b.all=Ne;function Ne(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,B=!1;if(!S)return this.resolve([]);for(var z=new Array(S),Y=0,V=-1,K=new this(_);++V<S;)ee(v[V],V);return K;function ee(he,we){C.resolve(he).then(De,function(se){B||(B=!0,L.reject(K,se))});function De(se){z[we]=se,++Y===S&&!B&&(B=!0,L.resolve(K,z))}}}b.race=ie;function ie(v){var C=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,B=!1;if(!S)return this.resolve([]);for(var z=-1,Y=new this(_);++z<S;)V(v[z]);return Y;function V(K){C.resolve(K).then(function(ee){B||(B=!0,L.resolve(Y,ee))},function(ee){B||(B=!0,L.reject(Y,ee))})}}},{"1":1}],3:[function(c,h,E){(function(y){"use strict";typeof y.Promise!="function"&&(y.Promise=c(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{"2":2}],4:[function(c,h,E){"use strict";var y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function L(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch(e){return}}var A=L();function N(){try{if(!A||!A.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),o=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||o)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch(t){return!1}}function G(e,o){e=e||[],o=o||{};try{return new Blob(e,o)}catch(a){if(a.name!=="TypeError")throw a;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,s=new t,f=0;f<e.length;f+=1)s.append(e[f]);return s.getBlob(o.type)}}typeof Promise>"u"&&c(3);var b=Promise;function T(e,o){o&&e.then(function(t){o(null,t)},function(t){o(t)})}function O(e,o,t){typeof o=="function"&&e.then(o),typeof t=="function"&&e.catch(t)}function X(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function J(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var $="local-forage-detect-blob-support",j=void 0,W={},Ne=Object.prototype.toString,ie="readonly",v="readwrite";function C(e){for(var o=e.length,t=new ArrayBuffer(o),s=new Uint8Array(t),f=0;f<o;f++)s[f]=e.charCodeAt(f);return t}function S(e){return new b(function(o){var t=e.transaction($,v),s=G([""]);t.objectStore($).put(s,"key"),t.onabort=function(f){f.preventDefault(),f.stopPropagation(),o(!1)},t.oncomplete=function(){var f=navigator.userAgent.match(/Chrome\/(\d+)/),a=navigator.userAgent.match(/Edge\//);o(a||!f||parseInt(f[1],10)>=43)}}).catch(function(){return!1})}function B(e){return typeof j=="boolean"?b.resolve(j):S(e).then(function(o){return j=o,j})}function z(e){var o=W[e.name],t={};t.promise=new b(function(s,f){t.resolve=s,t.reject=f}),o.deferredOperations.push(t),o.dbReady?o.dbReady=o.dbReady.then(function(){return t.promise}):o.dbReady=t.promise}function Y(e){var o=W[e.name],t=o.deferredOperations.pop();if(t)return t.resolve(),t.promise}function V(e,o){var t=W[e.name],s=t.deferredOperations.pop();if(s)return s.reject(o),s.promise}function K(e,o){return new b(function(t,s){if(W[e.name]=W[e.name]||gt(),e.db)if(o)z(e),e.db.close();else return t(e.db);var f=[e.name];o&&f.push(e.version);var a=A.open.apply(A,f);o&&(a.onupgradeneeded=function(u){var l=a.result;try{l.createObjectStore(e.storeName),u.oldVersion<=1&&l.createObjectStore($)}catch(d){if(d.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+u.oldVersion+" to version "+u.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw d}}),a.onerror=function(u){u.preventDefault(),s(a.error)},a.onsuccess=function(){var u=a.result;u.onversionchange=function(l){l.target.close()},t(u),Y(e)}})}function ee(e){return K(e,!1)}function he(e){return K(e,!0)}function we(e,o){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,f=e.version>e.db.version;if(s&&(e.version!==o&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),f||t){if(t){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function De(e){return new b(function(o,t){var s=new FileReader;s.onerror=t,s.onloadend=function(f){var a=btoa(f.target.result||"");o({__local_forage_encoded_blob:!0,data:a,type:e.type})},s.readAsBinaryString(e)})}function se(e){var o=C(atob(e.data));return G([o],{type:e.type})}function bt(e){return e&&e.__local_forage_encoded_blob}function lr(e){var o=this,t=o._initReady().then(function(){var s=W[o._dbInfo.name];if(s&&s.dbReady)return s.dbReady});return O(t,e,e),t}function dr(e){z(e);for(var o=W[e.name],t=o.forages,s=0;s<t.length;s++){var f=t[s];f._dbInfo.db&&(f._dbInfo.db.close(),f._dbInfo.db=null)}return e.db=null,ee(e).then(function(a){return e.db=a,we(e)?he(e):a}).then(function(a){e.db=o.db=a;for(var u=0;u<t.length;u++)t[u]._dbInfo.db=a}).catch(function(a){throw V(e,a),a})}function te(e,o,t,s){s===void 0&&(s=1);try{var f=e.db.transaction(e.storeName,o);t(null,f)}catch(a){if(s>0&&(!e.db||a.name==="InvalidStateError"||a.name==="NotFoundError"))return b.resolve().then(function(){if(!e.db||a.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),he(e)}).then(function(){return dr(e).then(function(){te(e,o,t,s-1)})}).catch(t);t(a)}}function gt(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function mr(e){var o=this,t={db:null};if(e)for(var s in e)t[s]=e[s];var f=W[t.name];f||(f=gt(),W[t.name]=f),f.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=lr);var a=[];function u(){return b.resolve()}for(var l=0;l<f.forages.length;l++){var d=f.forages[l];d!==o&&a.push(d._initReady().catch(u))}var m=f.forages.slice(0);return b.all(a).then(function(){return t.db=f.db,ee(t)}).then(function(p){return t.db=p,we(t,o._defaultConfig.version)?he(t):p}).then(function(p){t.db=f.db=p,o._dbInfo=t;for(var g=0;g<m.length;g++){var w=m[g];w!==o&&(w._dbInfo.db=t.db,w._dbInfo.version=t.version)}})}function pr(e,o){var t=this;e=X(e);var s=new b(function(f,a){t.ready().then(function(){te(t._dbInfo,ie,function(u,l){if(u)return a(u);try{var d=l.objectStore(t._dbInfo.storeName),m=d.get(e);m.onsuccess=function(){var p=m.result;p===void 0&&(p=null),bt(p)&&(p=se(p)),f(p)},m.onerror=function(){a(m.error)}}catch(p){a(p)}})}).catch(a)});return T(s,o),s}function hr(e,o){var t=this,s=new b(function(f,a){t.ready().then(function(){te(t._dbInfo,ie,function(u,l){if(u)return a(u);try{var d=l.objectStore(t._dbInfo.storeName),m=d.openCursor(),p=1;m.onsuccess=function(){var g=m.result;if(g){var w=g.value;bt(w)&&(w=se(w));var I=e(w,g.key,p++);I!==void 0?f(I):g.continue()}else f()},m.onerror=function(){a(m.error)}}catch(g){a(g)}})}).catch(a)});return T(s,o),s}function vr(e,o,t){var s=this;e=X(e);var f=new b(function(a,u){var l;s.ready().then(function(){return l=s._dbInfo,Ne.call(o)==="[object Blob]"?B(l.db).then(function(d){return d?o:De(o)}):o}).then(function(d){te(s._dbInfo,v,function(m,p){if(m)return u(m);try{var g=p.objectStore(s._dbInfo.storeName);d===null&&(d=void 0);var w=g.put(d,e);p.oncomplete=function(){d===void 0&&(d=null),a(d)},p.onabort=p.onerror=function(){var I=w.error?w.error:w.transaction.error;u(I)}}catch(I){u(I)}})}).catch(u)});return T(f,t),f}function br(e,o){var t=this;e=X(e);var s=new b(function(f,a){t.ready().then(function(){te(t._dbInfo,v,function(u,l){if(u)return a(u);try{var d=l.objectStore(t._dbInfo.storeName),m=d.delete(e);l.oncomplete=function(){f()},l.onerror=function(){a(m.error)},l.onabort=function(){var p=m.error?m.error:m.transaction.error;a(p)}}catch(p){a(p)}})}).catch(a)});return T(s,o),s}function gr(e){var o=this,t=new b(function(s,f){o.ready().then(function(){te(o._dbInfo,v,function(a,u){if(a)return f(a);try{var l=u.objectStore(o._dbInfo.storeName),d=l.clear();u.oncomplete=function(){s()},u.onabort=u.onerror=function(){var m=d.error?d.error:d.transaction.error;f(m)}}catch(m){f(m)}})}).catch(f)});return T(t,e),t}function yr(e){var o=this,t=new b(function(s,f){o.ready().then(function(){te(o._dbInfo,ie,function(a,u){if(a)return f(a);try{var l=u.objectStore(o._dbInfo.storeName),d=l.count();d.onsuccess=function(){s(d.result)},d.onerror=function(){f(d.error)}}catch(m){f(m)}})}).catch(f)});return T(t,e),t}function Er(e,o){var t=this,s=new b(function(f,a){if(e<0){f(null);return}t.ready().then(function(){te(t._dbInfo,ie,function(u,l){if(u)return a(u);try{var d=l.objectStore(t._dbInfo.storeName),m=!1,p=d.openKeyCursor();p.onsuccess=function(){var g=p.result;if(!g){f(null);return}e===0||m?f(g.key):(m=!0,g.advance(e))},p.onerror=function(){a(p.error)}}catch(g){a(g)}})}).catch(a)});return T(s,o),s}function Lr(e){var o=this,t=new b(function(s,f){o.ready().then(function(){te(o._dbInfo,ie,function(a,u){if(a)return f(a);try{var l=u.objectStore(o._dbInfo.storeName),d=l.openKeyCursor(),m=[];d.onsuccess=function(){var p=d.result;if(!p){s(m);return}m.push(p.key),p.continue()},d.onerror=function(){f(d.error)}}catch(p){f(p)}})}).catch(f)});return T(t,e),t}function xr(e,o){o=J.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var s=this,f;if(!e.name)f=b.reject("Invalid arguments");else{var a=e.name===t.name&&s._dbInfo.db,u=a?b.resolve(s._dbInfo.db):ee(e).then(function(l){var d=W[e.name],m=d.forages;d.db=l;for(var p=0;p<m.length;p++)m[p]._dbInfo.db=l;return l});e.storeName?f=u.then(function(l){if(!!l.objectStoreNames.contains(e.storeName)){var d=l.version+1;z(e);var m=W[e.name],p=m.forages;l.close();for(var g=0;g<p.length;g++){var w=p[g];w._dbInfo.db=null,w._dbInfo.version=d}var I=new b(function(R,F){var k=A.open(e.name,d);k.onerror=function(Q){var be=k.result;be.close(),F(Q)},k.onupgradeneeded=function(){var Q=k.result;Q.deleteObjectStore(e.storeName)},k.onsuccess=function(){var Q=k.result;Q.close(),R(Q)}});return I.then(function(R){m.db=R;for(var F=0;F<p.length;F++){var k=p[F];k._dbInfo.db=R,Y(k._dbInfo)}}).catch(function(R){throw(V(e,R)||b.resolve()).catch(function(){}),R})}}):f=u.then(function(l){z(e);var d=W[e.name],m=d.forages;l.close();for(var p=0;p<m.length;p++){var g=m[p];g._dbInfo.db=null}var w=new b(function(I,R){var F=A.deleteDatabase(e.name);F.onerror=function(){var k=F.result;k&&k.close(),R(F.error)},F.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},F.onsuccess=function(){var k=F.result;k&&k.close(),I(k)}});return w.then(function(I){d.db=I;for(var R=0;R<m.length;R++){var F=m[R];Y(F._dbInfo)}}).catch(function(I){throw(V(e,I)||b.resolve()).catch(function(){}),I})})}return T(f,o),f}var Tr={_driver:"asyncStorage",_initStorage:mr,_support:N(),iterate:hr,getItem:pr,setItem:vr,removeItem:br,clear:gr,length:yr,key:Er,keys:Lr,dropInstance:xr};function wr(){return typeof openDatabase=="function"}var ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pr="~~local_forage_type~",yt=/^~~local_forage_type~([^~]+)~/,Pe="__lfsc__:",Ue=Pe.length,ke="arbf",He="blob",Et="si08",Lt="ui08",xt="uic8",Tt="si16",wt="si32",Pt="ur16",St="ui32",Mt="fl32",_t="fl64",Ct=Ue+ke.length,It=Object.prototype.toString;function Rt(e){var o=e.length*.75,t=e.length,s,f=0,a,u,l,d;e[e.length-1]==="="&&(o--,e[e.length-2]==="="&&o--);var m=new ArrayBuffer(o),p=new Uint8Array(m);for(s=0;s<t;s+=4)a=ne.indexOf(e[s]),u=ne.indexOf(e[s+1]),l=ne.indexOf(e[s+2]),d=ne.indexOf(e[s+3]),p[f++]=a<<2|u>>4,p[f++]=(u&15)<<4|l>>2,p[f++]=(l&3)<<6|d&63;return m}function Oe(e){var o=new Uint8Array(e),t="",s;for(s=0;s<o.length;s+=3)t+=ne[o[s]>>2],t+=ne[(o[s]&3)<<4|o[s+1]>>4],t+=ne[(o[s+1]&15)<<2|o[s+2]>>6],t+=ne[o[s+2]&63];return o.length%3===2?t=t.substring(0,t.length-1)+"=":o.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function Sr(e,o){var t="";if(e&&(t=It.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&It.call(e.buffer)==="[object ArrayBuffer]")){var s,f=Pe;e instanceof ArrayBuffer?(s=e,f+=ke):(s=e.buffer,t==="[object Int8Array]"?f+=Et:t==="[object Uint8Array]"?f+=Lt:t==="[object Uint8ClampedArray]"?f+=xt:t==="[object Int16Array]"?f+=Tt:t==="[object Uint16Array]"?f+=Pt:t==="[object Int32Array]"?f+=wt:t==="[object Uint32Array]"?f+=St:t==="[object Float32Array]"?f+=Mt:t==="[object Float64Array]"?f+=_t:o(new Error("Failed to get type for BinaryArray"))),o(f+Oe(s))}else if(t==="[object Blob]"){var a=new FileReader;a.onload=function(){var u=Pr+e.type+"~"+Oe(this.result);o(Pe+He+u)},a.readAsArrayBuffer(e)}else try{o(JSON.stringify(e))}catch(u){console.error("Couldn't convert value into a JSON string: ",e),o(null,u)}}function Mr(e){if(e.substring(0,Ue)!==Pe)return JSON.parse(e);var o=e.substring(Ct),t=e.substring(Ue,Ct),s;if(t===He&&yt.test(o)){var f=o.match(yt);s=f[1],o=o.substring(f[0].length)}var a=Rt(o);switch(t){case ke:return a;case He:return G([a],{type:s});case Et:return new Int8Array(a);case Lt:return new Uint8Array(a);case xt:return new Uint8ClampedArray(a);case Tt:return new Int16Array(a);case Pt:return new Uint16Array(a);case wt:return new Int32Array(a);case St:return new Uint32Array(a);case Mt:return new Float32Array(a);case _t:return new Float64Array(a);default:throw new Error("Unkown type: "+t)}}var Fe={serialize:Sr,deserialize:Mr,stringToBuffer:Rt,bufferToString:Oe};function Bt(e,o,t,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,s)}function _r(e){var o=this,t={db:null};if(e)for(var s in e)t[s]=typeof e[s]!="string"?e[s].toString():e[s];var f=new b(function(a,u){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(l){return u(l)}t.db.transaction(function(l){Bt(l,t,function(){o._dbInfo=t,a()},function(d,m){u(m)})},u)});return t.serializer=Fe,f}function oe(e,o,t,s,f,a){e.executeSql(t,s,f,function(u,l){l.code===l.SYNTAX_ERR?u.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[o.storeName],function(d,m){m.rows.length?a(d,l):Bt(d,o,function(){d.executeSql(t,s,f,a)},a)},a):a(u,l)},a)}function Cr(e,o){var t=this;e=X(e);var s=new b(function(f,a){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){oe(l,u,"SELECT * FROM "+u.storeName+" WHERE key = ? LIMIT 1",[e],function(d,m){var p=m.rows.length?m.rows.item(0).value:null;p&&(p=u.serializer.deserialize(p)),f(p)},function(d,m){a(m)})})}).catch(a)});return T(s,o),s}function Ir(e,o){var t=this,s=new b(function(f,a){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){oe(l,u,"SELECT * FROM "+u.storeName,[],function(d,m){for(var p=m.rows,g=p.length,w=0;w<g;w++){var I=p.item(w),R=I.value;if(R&&(R=u.serializer.deserialize(R)),R=e(R,I.key,w+1),R!==void 0){f(R);return}}f()},function(d,m){a(m)})})}).catch(a)});return T(s,o),s}function At(e,o,t,s){var f=this;e=X(e);var a=new b(function(u,l){f.ready().then(function(){o===void 0&&(o=null);var d=o,m=f._dbInfo;m.serializer.serialize(o,function(p,g){g?l(g):m.db.transaction(function(w){oe(w,m,"INSERT OR REPLACE INTO "+m.storeName+" (key, value) VALUES (?, ?)",[e,p],function(){u(d)},function(I,R){l(R)})},function(w){if(w.code===w.QUOTA_ERR){if(s>0){u(At.apply(f,[e,d,t,s-1]));return}l(w)}})})}).catch(l)});return T(a,t),a}function Rr(e,o,t){return At.apply(this,[e,o,t,1])}function Br(e,o){var t=this;e=X(e);var s=new b(function(f,a){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){oe(l,u,"DELETE FROM "+u.storeName+" WHERE key = ?",[e],function(){f()},function(d,m){a(m)})})}).catch(a)});return T(s,o),s}function Ar(e){var o=this,t=new b(function(s,f){o.ready().then(function(){var a=o._dbInfo;a.db.transaction(function(u){oe(u,a,"DELETE FROM "+a.storeName,[],function(){s()},function(l,d){f(d)})})}).catch(f)});return T(t,e),t}function Nr(e){var o=this,t=new b(function(s,f){o.ready().then(function(){var a=o._dbInfo;a.db.transaction(function(u){oe(u,a,"SELECT COUNT(key) as c FROM "+a.storeName,[],function(l,d){var m=d.rows.item(0).c;s(m)},function(l,d){f(d)})})}).catch(f)});return T(t,e),t}function Dr(e,o){var t=this,s=new b(function(f,a){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(l){oe(l,u,"SELECT key FROM "+u.storeName+" WHERE id = ? LIMIT 1",[e+1],function(d,m){var p=m.rows.length?m.rows.item(0).key:null;f(p)},function(d,m){a(m)})})}).catch(a)});return T(s,o),s}function Ur(e){var o=this,t=new b(function(s,f){o.ready().then(function(){var a=o._dbInfo;a.db.transaction(function(u){oe(u,a,"SELECT key FROM "+a.storeName,[],function(l,d){for(var m=[],p=0;p<d.rows.length;p++)m.push(d.rows.item(p).key);s(m)},function(l,d){f(d)})})}).catch(f)});return T(t,e),t}function kr(e){return new b(function(o,t){e.transaction(function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(f,a){for(var u=[],l=0;l<a.rows.length;l++)u.push(a.rows.item(l).name);o({db:e,storeNames:u})},function(f,a){t(a)})},function(s){t(s)})})}function Hr(e,o){o=J.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var s=this,f;return e.name?f=new b(function(a){var u;e.name===t.name?u=s._dbInfo.db:u=openDatabase(e.name,"","",0),e.storeName?a({db:u,storeNames:[e.storeName]}):a(kr(u))}).then(function(a){return new b(function(u,l){a.db.transaction(function(d){function m(I){return new b(function(R,F){d.executeSql("DROP TABLE IF EXISTS "+I,[],function(){R()},function(k,Q){F(Q)})})}for(var p=[],g=0,w=a.storeNames.length;g<w;g++)p.push(m(a.storeNames[g]));b.all(p).then(function(){u()}).catch(function(I){l(I)})},function(d){l(d)})})}):f=b.reject("Invalid arguments"),T(f,o),f}var Or={_driver:"webSQLStorage",_initStorage:_r,_support:wr(),iterate:Ir,getItem:Cr,setItem:Rr,removeItem:Br,clear:Ar,length:Nr,key:Dr,keys:Ur,dropInstance:Hr};function Fr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Nt(e,o){var t=e.name+"/";return e.storeName!==o.storeName&&(t+=e.storeName+"/"),t}function Xr(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(o){return!0}}function $r(){return!Xr()||localStorage.length>0}function Wr(e){var o=this,t={};if(e)for(var s in e)t[s]=e[s];return t.keyPrefix=Nt(e,o._defaultConfig),$r()?(o._dbInfo=t,t.serializer=Fe,b.resolve()):b.reject()}function zr(e){var o=this,t=o.ready().then(function(){for(var s=o._dbInfo.keyPrefix,f=localStorage.length-1;f>=0;f--){var a=localStorage.key(f);a.indexOf(s)===0&&localStorage.removeItem(a)}});return T(t,e),t}function Gr(e,o){var t=this;e=X(e);var s=t.ready().then(function(){var f=t._dbInfo,a=localStorage.getItem(f.keyPrefix+e);return a&&(a=f.serializer.deserialize(a)),a});return T(s,o),s}function Yr(e,o){var t=this,s=t.ready().then(function(){for(var f=t._dbInfo,a=f.keyPrefix,u=a.length,l=localStorage.length,d=1,m=0;m<l;m++){var p=localStorage.key(m);if(p.indexOf(a)===0){var g=localStorage.getItem(p);if(g&&(g=f.serializer.deserialize(g)),g=e(g,p.substring(u),d++),g!==void 0)return g}}});return T(s,o),s}function Vr(e,o){var t=this,s=t.ready().then(function(){var f=t._dbInfo,a;try{a=localStorage.key(e)}catch(u){a=null}return a&&(a=a.substring(f.keyPrefix.length)),a});return T(s,o),s}function Kr(e){var o=this,t=o.ready().then(function(){for(var s=o._dbInfo,f=localStorage.length,a=[],u=0;u<f;u++){var l=localStorage.key(u);l.indexOf(s.keyPrefix)===0&&a.push(l.substring(s.keyPrefix.length))}return a});return T(t,e),t}function Qr(e){var o=this,t=o.keys().then(function(s){return s.length});return T(t,e),t}function Jr(e,o){var t=this;e=X(e);var s=t.ready().then(function(){var f=t._dbInfo;localStorage.removeItem(f.keyPrefix+e)});return T(s,o),s}function qr(e,o,t){var s=this;e=X(e);var f=s.ready().then(function(){o===void 0&&(o=null);var a=o;return new b(function(u,l){var d=s._dbInfo;d.serializer.serialize(o,function(m,p){if(p)l(p);else try{localStorage.setItem(d.keyPrefix+e,m),u(a)}catch(g){(g.name==="QuotaExceededError"||g.name==="NS_ERROR_DOM_QUOTA_REACHED")&&l(g),l(g)}})})});return T(f,t),f}function Zr(e,o){if(o=J.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var s=this,f;return e.name?f=new b(function(a){e.storeName?a(Nt(e,s._defaultConfig)):a(e.name+"/")}).then(function(a){for(var u=localStorage.length-1;u>=0;u--){var l=localStorage.key(u);l.indexOf(a)===0&&localStorage.removeItem(l)}}):f=b.reject("Invalid arguments"),T(f,o),f}var jr={_driver:"localStorageWrapper",_initStorage:Wr,_support:Fr(),iterate:Yr,getItem:Gr,setItem:qr,removeItem:Jr,clear:zr,length:Qr,key:Vr,keys:Kr,dropInstance:Zr},en=function(o,t){return o===t||typeof o=="number"&&typeof t=="number"&&isNaN(o)&&isNaN(t)},tn=function(o,t){for(var s=o.length,f=0;f<s;){if(en(o[f],t))return!0;f++}return!1},Dt=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},ve={},Ut={},fe={INDEXEDDB:Tr,WEBSQL:Or,LOCALSTORAGE:jr},rn=[fe.INDEXEDDB._driver,fe.WEBSQL._driver,fe.LOCALSTORAGE._driver],Se=["dropInstance"],Xe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Se),nn={description:"",driver:rn.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function on(e,o){e[o]=function(){var t=arguments;return e.ready().then(function(){return e[o].apply(e,t)})}}function $e(){for(var e=1;e<arguments.length;e++){var o=arguments[e];if(o)for(var t in o)o.hasOwnProperty(t)&&(Dt(o[t])?arguments[0][t]=o[t].slice():arguments[0][t]=o[t])}return arguments[0]}var an=function(){function e(o){_(this,e);for(var t in fe)if(fe.hasOwnProperty(t)){var s=fe[t],f=s._driver;this[t]=f,ve[f]||this.defineDriver(s)}this._defaultConfig=$e({},nn),this._config=$e({},this._defaultConfig,o),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":y(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var s in t){if(s==="storeName"&&(t[s]=t[s].replace(/\W/g,"_")),s==="version"&&typeof t[s]!="number")return new Error("Database version must be a number.");this._config[s]=t[s]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,s,f){var a=new b(function(u,l){try{var d=t._driver,m=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){l(m);return}for(var p=Xe.concat("_initStorage"),g=0,w=p.length;g<w;g++){var I=p[g],R=!tn(Se,I);if((R||t[I])&&typeof t[I]!="function"){l(m);return}}var F=function(){for(var be=function(cn){return function(){var un=new Error("Method "+cn+" is not implemented by the current driver"),kt=b.reject(un);return T(kt,arguments[arguments.length-1]),kt}},We=0,fn=Se.length;We<fn;We++){var ze=Se[We];t[ze]||(t[ze]=be(ze))}};F();var k=function(be){ve[d]&&console.info("Redefining LocalForage driver: "+d),ve[d]=t,Ut[d]=be,u()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(k,l):k(!!t._support):k(!0)}catch(Q){l(Q)}});return O(a,s,f),a},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,s,f){var a=ve[t]?b.resolve(ve[t]):b.reject(new Error("Driver not found."));return O(a,s,f),a},e.prototype.getSerializer=function(t){var s=b.resolve(Fe);return O(s,t),s},e.prototype.ready=function(t){var s=this,f=s._driverSet.then(function(){return s._ready===null&&(s._ready=s._initDriver()),s._ready});return O(f,t,t),f},e.prototype.setDriver=function(t,s,f){var a=this;Dt(t)||(t=[t]);var u=this._getSupportedDrivers(t);function l(){a._config.driver=a.driver()}function d(g){return a._extend(g),l(),a._ready=a._initStorage(a._config),a._ready}function m(g){return function(){var w=0;function I(){for(;w<g.length;){var R=g[w];return w++,a._dbInfo=null,a._ready=null,a.getDriver(R).then(d).catch(I)}l();var F=new Error("No available storage method found.");return a._driverSet=b.reject(F),a._driverSet}return I()}}var p=this._driverSet!==null?this._driverSet.catch(function(){return b.resolve()}):b.resolve();return this._driverSet=p.then(function(){var g=u[0];return a._dbInfo=null,a._ready=null,a.getDriver(g).then(function(w){a._driver=w._driver,l(),a._wrapLibraryMethodsWithReady(),a._initDriver=m(u)})}).catch(function(){l();var g=new Error("No available storage method found.");return a._driverSet=b.reject(g),a._driverSet}),O(this._driverSet,s,f),this._driverSet},e.prototype.supports=function(t){return!!Ut[t]},e.prototype._extend=function(t){$e(this,t)},e.prototype._getSupportedDrivers=function(t){for(var s=[],f=0,a=t.length;f<a;f++){var u=t[f];this.supports(u)&&s.push(u)}return s},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,s=Xe.length;t<s;t++)on(this,Xe[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),sn=new an;h.exports=sn},{"3":3}]},{},[4])(4)})});var Ye=n=>{let r=typeof n;return n!==null&&(r==="object"||r==="function")},Ge=new Set(["__proto__","prototype","constructor"]),xn=new Set("0123456789");function Wt(n){let r=[],i="",c="start",h=!1;for(let E of n)switch(E){case"\\":if(c==="index")throw new Error("Invalid character in an index");if(c==="indexEnd")throw new Error("Invalid character after an index");h&&(i+=E),c="property",h=!h;break;case".":if(c==="index")throw new Error("Invalid character in an index");if(c==="indexEnd"){c="property";break}if(h){h=!1,i+=E;break}if(Ge.has(i))return[];r.push(i),i="",c="property";break;case"[":if(c==="index")throw new Error("Invalid character in an index");if(c==="indexEnd"){c="index";break}if(h){h=!1,i+=E;break}if(c==="property"){if(Ge.has(i))return[];r.push(i),i=""}c="index";break;case"]":if(c==="index"){r.push(Number.parseInt(i,10)),i="",c="indexEnd";break}if(c==="indexEnd")throw new Error("Invalid character after an index");default:if(c==="index"&&!xn.has(E))throw new Error("Invalid character in an index");if(c==="indexEnd")throw new Error("Invalid character after an index");c==="start"&&(c="property"),h&&(h=!1,i+="\\"),i+=E}switch(h&&(i+="\\"),c){case"property":{if(Ge.has(i))return[];r.push(i);break}case"index":throw new Error("Index was not closed");case"start":{r.push("");break}}return r}function zt(n,r){if(typeof r!="number"&&Array.isArray(n)){let i=Number.parseInt(r,10);return Number.isInteger(i)&&n[i]===n[r]}return!1}function Tn(n,r){if(zt(n,r))throw new Error("Cannot use string index")}function H(n,r,i){if(!Ye(n)||typeof r!="string")return i===void 0?n:i;let c=Wt(r);if(c.length===0)return i;for(let h=0;h<c.length;h++){let E=c[h];if(zt(n,E)?n=h===c.length-1?void 0:null:n=n[E],n==null){if(h!==c.length-1)return i;break}}return n===void 0?i:n}function Gt(n,r,i){if(!Ye(n)||typeof r!="string")return n;let c=n,h=Wt(r);for(let E=0;E<h.length;E++){let y=h[E];Tn(n,y),E===h.length-1?n[y]=i:Ye(n[y])||(n[y]=typeof h[E+1]=="number"?[]:{}),n=n[y]}return c}var pe=Ln(Vt());var U=n=>document.getElementById(n),Kt=(n,r)=>{if(document.visibilityState==="hidden")return!1;let i=Object.entries(r);for(let[c,h]of i)n[c]=h;return!0},P=(n,r)=>document.visibilityState==="hidden"?!1:Kt(U(n),r),D=(n,r)=>document.visibilityState==="hidden"?!1:Kt(U(n).style,r);var re=(n,r)=>n.querySelector(r),wn=(n,r)=>{let i=U("confirmationBox"),c=U("confirmWrapper"),h=re(document,"#confirm"),E=re(document,"#transparentBG"),y=re(h,"#okConfirm"),_=re(h,"#cancelConfirm");i.style.display="block",c.style.display="block",E.style.display="block",re(h,"p").textContent=n,h.focus();let L=({target:N})=>{let G=N;return y.removeEventListener("click",L),_.removeEventListener("click",L),h.removeEventListener("keyup",A),i.style.display="none",c.style.display="none",E.style.display="none",r(G===y)},A=N=>N.key==="Enter"||N.key===" "?L({target:y}):N.key==="Escape"?L({target:_}):N.preventDefault();y.addEventListener("click",L),_.addEventListener("click",L),h.addEventListener("keyup",A)},Pn=(n,r)=>{let i=U("confirmationBox"),c=U("alertWrapper"),h=re(document,"#transparentBG"),E=re(document,"#alert"),y=re(E,"#okAlert");i.style.display="block",c.style.display="block",h.style.display="block",re(E,"p").textContent=n,E.focus();let _=()=>{y.removeEventListener("click",_),E.removeEventListener("keyup",L),i.style.display="none",c.style.display="none",h.style.display="none",r(void 0)},L=A=>(A.key==="Enter"||A.key===" ")&&_();y.addEventListener("click",_),E.addEventListener("keyup",L)};var q=n=>new Promise(r=>Pn(n,r));var _e=n=>new Promise(r=>wn(n,r));var x=(n,r=0)=>{if(n<0)return"-"+x(-n,r);if(n>=1e6){let A=Math.floor(Math.log10(n));return n/=Math.pow(10,A),x(n,2)+"e"+x(A)}let i=Math.floor(n),c=n-i,h=i.toLocaleString(),E=r>0&&n!==0,y=Math.pow(10,r)*c,_=1e-6;Math.ceil(y)-y<_&&(y=Math.ceil(y));let L=E?Math.floor(y).toString():"";if(L!==""){for(;L.length<r;)L="0"+L;L="."+L}return h+L};var ye=class{constructor(r=0,i){this.amount=r;this.player=i;this.amount=r,this.updateHTML()}spend(r){this.amount>=r&&(this.amount-=r,this.updateHTML())}gain(r){this.amount+=r,this.updateHTML()}set(r){this.amount=r,this.updateHTML()}valueOf(){return{amount:this.amount}}};var Ke=class extends ye{updateHTML(){P("gold-amount",{textContent:x(this.amount)})}};var Qe=class extends ye{updateHTML(){P("fragment-amount",{textContent:x(this.amount)}),P("fragment-bonus",{textContent:x(this.amount)}),P("fragment-gain",{textContent:x(this.getAmountOnRefresh())})}getAmountOnRefresh(){let r=this.player.barLevel,i=100*Math.pow(1.07,-5);return i*=Math.pow(1.07,r),i*=Math.pow(3,Math.floor(r/100)),i*=1+this.player.criticalHitsThisRefresh*this.player.coinUpgrades.barAgitation.upgradeEffect(),Math.floor(i)}unspentBonus(){return 1+1/100*this.amount}};var ce=n=>{D("mainTab",{display:"none"}),D("upgradeTab",{display:"none"}),D("talentsTab",{display:"none"}),n==="Main"?D("mainTab",{display:"block"}):n==="Upgrades"?D("upgradeTab",{display:"block"}):n==="Talents"&&D("talentsTab",{display:"block"})},Ce=n=>{D("progression",{backgroundColor:"gold"}),setTimeout(()=>{D("progression",{backgroundColor:ue(n)})},250),P("refresh-crit-counter",{textContent:x(n.criticalHitsThisRefresh)}),n.barFragments.updateHTML()},Ie=n=>{D("progression",{backgroundColor:"cyan"}),setTimeout(()=>{D("progression",{backgroundColor:ue(n)})},1e3),P("coinWorth",{textContent:`Worth ${x(ae(n))} coins`}),P("refresh-crit-counter",{textContent:x(n.criticalHitsThisRefresh)}),P("refresh-counter",{textContent:x(n.refreshCount)})};var Sn=10,Re=0,Je=0,Ee=n=>{let r=0;return r+=Sn*Math.pow(n.barLevel+1,2),r*=Math.min(1,(n.barLevel+20)/40),r*=Math.max(1,1+(n.barLevel-20)/10),n.barLevel>40&&(r*=Math.pow(2,1/10*(n.barLevel-40))),n.barLevel>100&&(r*=Math.pow(2,1/10*(n.barLevel-100))),n.barLevel>200&&(r*=Math.pow(2,1/10*(n.barLevel-200))),r},Mn=n=>{let r=0;return n.barLevel>=5&&(r=.1),n.barLevel>=10&&(r+=.9*(1-Math.pow(Math.E,-n.barLevel/200))),r>=.9999?1e4:1/(1-r)},_n=n=>Mn(n)*(1-n.barEXP/n.barTNL),Qt=(n,r)=>{if(n==null)return;let i=1;i+=r.coinUpgrades.barSpeed.upgradeEffect(),i*=r.barFragments.unspentBonus(),i*=Math.pow(1+r.coinUpgrades.barMomentum.upgradeEffect(),Math.sqrt(100*Math.min(1,r.barEXP/r.barTNL))),i/=_n(r),i*=r.talents.barSpeed.talentEffect();let c=Math.random(),h=r.coinUpgrades.barReverberation.upgradeEffect()+r.talents.barCriticalChance.talentEffect();c<h&&(i*=r.coinUpgrades.barVibration.upgradeEffect(),r.talents.barCriticalChance.gainEXP(n),r.criticalHits+=1,r.criticalHitsThisRefresh+=1,Ce(r));let E=i*n;r.barEXP+=E,Re+=E,P("perSecCurr",{textContent:`+${x(Re,2)} this sec`})},le=(n,r)=>Math.min(100,.1*Math.floor(1e3*n/r)),de=n=>{D("progression",{width:`${n}%`})},ue=n=>{if(n.barLevel>=128)return"#FFFFFF";let r=(128+n.barLevel).toString(16).padStart(2,"0"),i=(2*n.barLevel).toString(16).padStart(2,"0"),c=(128+n.barLevel).toString(16).padStart(2,"0");return`#${r}${i}${c}`},Jt=n=>{n.coins.gain(ae(n)),n.barEXP-=n.barTNL,n.barLevel+=1,n.barLevel>n.highestBarLevel&&(n.highestBarLevel=n.barLevel);let r=ue(n);D("progression",{backgroundColor:r}),n.barTNL=Ee(n),n.barEXP/=10,n.barEXP=Math.min(n.barEXP,Math.floor(n.barTNL/10));let i=le(n.barEXP,n.barTNL);de(i),P("coinWorth",{textContent:`Worth ${x(ae(n))} coins`}),n.barFragments.updateHTML(),n.barLevel===20&&(n.talents.barCriticalChance.updateHTML("Level20"),n.talents.barSpeed.updateHTML("Level20"))},qt=n=>{P("level",{textContent:`Level: ${n.barLevel}`}),P("exp",{textContent:`EXP: ${x(n.barEXP)}/${x(n.barTNL)}`})},Zt=n=>{Je=Re,Re=0,P("perSecPrev",{textContent:`+${x(Je,2)} prev sec`}),n.talents.barCriticalChance.updateHTML("Time"),n.talents.barSpeed.gainEXP(Je)},ae=n=>{let r=0,i=1+n.barLevel;i>n.highestBarLevel&&(r+=3),i%5===0&&(r+=Math.floor(i/5)+3),i%10===0&&(r+=Math.floor(i/2)),i%50===0&&(r+=Math.floor(i/2)),i%100===0&&(r+=Math.floor(i));let c=U("coinWorth");return c.style.color=r>0?"gold":"grey",r};var Le=class{constructor(r,i,c){this.level=r;this.cost=i;this.player=c}};var me=class extends Le{constructor(r,i,c){super(r,i,c);this.updateHTML()}capLevel(){this.maxLevel!==-1&&(this.level=Math.min(this.maxLevel,this.level))}purchaseLevels(r,i){i.shiftKey&&(r=-1,r=Math.floor(this.player.coins.amount/this.cost)),this.maxLevel!==-1&&(r=Math.min(r,this.maxLevel-this.level)),this.cost*r<=this.player.coins.amount&&(this.player.coins.spend(this.cost*r),this.level+=r,this.updateHTML())}valueOf(){return{level:this.level,cost:this.cost,maxLevel:this.maxLevel}}},Z={barSpeed:1,barMomentum:10,barReverberation:25,barVibration:50,barAgitation:1e4},qe=class extends me{constructor(){super(...arguments);this.maxLevel=-1}upgradeEffect(){return 4*this.level/100+.06*Math.min(90,this.level)}updateHTML(){P("coin-bar-speed-effect",{textContent:`+${x(this.upgradeEffect(),2)} Progress Per Second`})}},Ze=class extends me{constructor(r,i,c){super(r,i,c);this.expoDivisor=400;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.capLevel(),this.updateHTML()}upgradeEffect(){return this.maxLevel===this.level?.5:.45*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+1/200*Math.min(10,this.level)}updateHTML(){P("coin-bar-momentum-effect",{textContent:`Up to ${x(Math.pow(1+this.upgradeEffect(),10),2)}x Progress Speed based on fill%`}),this.level===this.maxLevel&&(P("coin-bar-momentum-name",{textContent:"Bar Momentum [MAX LEVEL]"}),D("coin-bar-momentum-name",{color:"orchid"}))}},je=class extends me{constructor(r,i,c){super(r,i,c);this.expoDivisor=100;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level===this.maxLevel?.1:.09*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+.002*Math.min(5,this.level)}updateHTML(){P("coin-bar-reverberation-effect",{textContent:`+${x(100*this.upgradeEffect(),2)}% chance to have a CRITICAL TICK`}),this.level===this.maxLevel&&(P("coin-bar-reverberation-name",{textContent:"Bar Reverberation [MAX LEVEL]"}),D("coin-bar-reverberation-name",{color:"orchid"}))}},et=class extends me{constructor(r,i,c){super(r,i,c);this.expoDivisor=170;this.maxLevel=Math.ceil(this.expoDivisor*Math.log(1e3));this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level===this.maxLevel?200:20+170*(1-Math.pow(Math.E,-this.level/this.expoDivisor))+Math.min(10,this.level)}updateHTML(){P("coin-bar-vibration-effect",{textContent:`CRITICAL TICKS fill up the bar ${x(this.upgradeEffect(),2)}x faster`}),this.level===this.maxLevel&&(P("coin-bar-vibration-name",{textContent:"Bar Vibration [MAX LEVEL]"}),D("coin-bar-vibration-name",{color:"orchid"}))}},tt=class extends me{constructor(r,i,c){super(r,i,c);this.maxLevel=10;this.capLevel(),this.updateHTML()}upgradeEffect(){return this.level/5e3}updateHTML(){P("coin-bar-agitation-effect",{textContent:`+${x(100*this.upgradeEffect(),2)}% Bar Fragments per CRIT`}),this.level===this.maxLevel&&(P("coin-bar-agitation-name",{textContent:"Bar Agitation [MAX LEVEL]"}),D("coin-bar-agitation-name",{color:"orchid"}))}};var jt="coinUpgrades.barSpeed",rt=(n,r)=>{var c,h;let i=(c=H(n,jt))!=null?c:H(r,jt);return new qe((h=i==null?void 0:i.level)!=null?h:0,Z.barSpeed,r)};var er="coinUpgrades.barMomentum",nt=(n,r)=>{var c,h;let i=(c=H(n,er))!=null?c:H(r,er);return new Ze((h=i==null?void 0:i.level)!=null?h:0,Z.barMomentum,r)};var tr="coinUpgrades.barReverberation",ot=(n,r)=>{var c,h;let i=(c=H(n,tr))!=null?c:H(r,tr);return new je((h=i==null?void 0:i.level)!=null?h:0,Z.barReverberation,r)};var rr="coinUpgrades.barVibration",at=(n,r)=>{var c,h;let i=(c=H(n,rr))!=null?c:H(r,rr);return new et((h=i==null?void 0:i.level)!=null?h:0,Z.barVibration,r)};var nr="coinUpgrades.barAgitation",it=(n,r)=>{var c,h;let i=(c=H(n,nr))!=null?c:H(r,nr);return new tt((h=i==null?void 0:i.level)!=null?h:0,Z.barAgitation,r)};var or=(n,r,i,c=1)=>Math.ceil(n*(Math.pow(i,c)-Math.pow(r,c)));var Be=(n,r)=>{if(n==="Refresh"&&r.barLevel>=5){if(r.refreshTime<xe)return void q(`Currently, refreshes have a ${x(xe)} second cooldown. Sorry!`);r.barFragments.set(r.barFragments.getAmountOnRefresh()),r.barEXP=0,r.barLevel=0,r.barTNL=Ee(r),de(le(r.barEXP,r.barTNL)),r.barFragments.updateHTML(),r.talents.barCriticalChance.convertToPerm(),r.talents.barCriticalChance.updateHTML("Initialize"),r.talents.barSpeed.convertToPerm(),r.talents.barSpeed.updateHTML("Initialize"),r.refreshCount+=1,r.refreshTime=0,r.criticalHitsThisRefresh=0,Ce(r),Ie(r)}else return void q("You cannot refresh yet. Get to level 5 lol")};var st=n=>n.barLevel>=20,ft=class extends Le{constructor(r,i,c,h,E,y){super(r,i,y);this.investedFragments=c,this.permLevel=h,this.currEXP=E,this.currTNL=this.calculateTNL()}calculateTNL(){return or(this.cost,this.level,this.level+1,2)}setEXP(r){this.currEXP=r,this.updateHTML("GainEXP")}gainEXP(r){if(!st(this.player))return;let i=this.calculateEXPGain(r);this.currEXP+=i,this.currEXP>=this.currTNL&&this.levelUp(),this.updateHTML("GainEXP")}levelUp(){this.level+=1,this.setEXP(0),this.currTNL=this.calculateTNL(),this.updateHTML("LevelUp")}computePermLevelGain(r){let i=0;return i+=Math.sqrt(r),i*=Math.min(4,Math.pow(this.player.refreshTime/300,2)),i=Math.min(r,i),Math.floor(i)}convertToPerm(){this.permLevel+=this.computePermLevelGain(this.level),this.level=0,this.setEXP(0),this.currTNL=this.calculateTNL(),this.updateHTML("PermLevelUp")}getBarWidth(){return Math.min(100,100*this.currEXP/this.currTNL)}async sacrificeFragments(){if(this.player.barFragments.amount<1e3)return void q("You cannot sacrifice your bar fragments until you have at least 1,000 of them.");if(this.player.barFragments.amount<=this.investedFragments)return void q(`This bar needs more fragments than you can invest. You need ${x(this.investedFragments)}.`);await _e(`You will sacrifice ${x(this.player.barFragments.amount-this.investedFragments)} Bar Fragments to increase EXP gain for this bar. Will you? (automatically performs a refresh, setting your fragments to 0)`)&&(this.investedFragments=this.player.barFragments.amount,this.player.refreshTime+=xe,Be("Refresh",this.player),this.player.barFragments.set(0))}updateHTML(r){if(this.idHTML!==void 0){if(r==="Initialize"||r==="GainEXP"||r==="LevelUp"||r==="PermLevelUp"){P(`talent${this.idHTML}EXP`,{textContent:`EXP: ${x(this.currEXP)}/${x(this.currTNL)}`});let i=`${this.getBarWidth()}%`;D(`talent${this.idHTML}Progression`,{width:i})}(r==="Initialize"||r==="LevelUp"||r==="PermLevelUp")&&P(`talent${this.idHTML}TempLevel`,{textContent:`Level this run: ${x(this.level)}`}),(r==="Initialize"||r==="PermLevelUp")&&P(`talent${this.idHTML}PermLevel`,{textContent:`Banked levels: ${x(this.permLevel)}`}),(r==="Initialize"||r==="Time"||r==="LevelUp")&&P(`talent${this.idHTML}PermGain`,{textContent:`Banked on reset: +${x(this.computePermLevelGain(this.level))}`}),(r==="Initialize"||r==="LevelUp"||r==="PermLevelUp"||r==="Level20")&&P(`talent${this.idHTML}Effect`,{textContent:this.displayEffect()})}}valueOf(){return{level:this.level,cost:this.cost,investedFragments:this.investedFragments,permLevel:this.permLevel,currEXP:this.currEXP,idHTML:this.idHTML}}},Ae={talentCriticalChance:10,talentProgressSpeed:10},ct=class extends ft{constructor(r,i,c,h,E,y){super(r,i,c,h,E,y);this.idHTML="CriticalChance";this.updateHTML("Initialize")}calculateEXPGain(r){let i=1;return i*=r*1e3/lt,i*=this.player.barLevel/10-1,i*=1+1/9*Math.pow(Math.log2(1+this.investedFragments/125),2),i}talentEffect(){return st(this.player)?.025*(1-Math.pow(Math.E,-this.level/2500))+.025*Math.min(250,this.level)/250+.025*(1-Math.pow(Math.E,-this.permLevel/4e3))+.025*Math.min(500,this.level)/500:0}displayEffect(){return`+${x(100*this.talentEffect(),3)}% chance of CRITICAL TICK`}},ut=class extends ft{constructor(r,i,c,h,E,y){super(r,i,c,h,E,y);this.idHTML="ProgressSpeed";this.updateHTML("Initialize")}calculateEXPGain(r){let i=Math.log10(1+r);return i*=this.player.barLevel/10-1,i*=1+1/9*Math.pow(Math.log2(1+this.investedFragments/125),2),i}talentEffect(){return st?(1+this.level/25)*(1+this.permLevel/50):0}displayEffect(){return`Progress Speed +${x(100*(this.talentEffect()-1),2)}%`}};var ar="talents.barCriticalChance",dt=(n,r)=>{var c,h,E,y,_;let i=(c=H(n,ar))!=null?c:H(r,ar);return new ct((h=i==null?void 0:i.level)!=null?h:0,Ae.talentCriticalChance,(E=i==null?void 0:i.investedFragments)!=null?E:0,(y=i==null?void 0:i.permLevel)!=null?y:0,(_=i==null?void 0:i.currEXP)!=null?_:0,r)};var ir="talents.barSpeed",mt=(n,r)=>{var c,h,E,y,_;let i=(c=H(n,ir))!=null?c:H(r,ir);return new ut((h=i==null?void 0:i.level)!=null?h:0,Ae.talentCriticalChance,(E=i==null?void 0:i.investedFragments)!=null?E:0,(y=i==null?void 0:i.permLevel)!=null?y:0,(_=i==null?void 0:i.currEXP)!=null?_:0,r)};var M={firstPlayed:new Date,barEXP:0,barTNL:0,totalEXP:0,barLevel:0,highestBarLevel:0,refreshCount:0,refreshTime:0,criticalHits:0,criticalHitsThisRefresh:0},fr=Object.assign({},M),In=async n=>{await pe.default.removeItem("UPBSave");let r=$t(Xt({},n),{coins:n.coins.valueOf(),coinUpgrades:{barSpeed:n.coinUpgrades.barSpeed.valueOf(),barMomentum:n.coinUpgrades.barMomentum.valueOf(),barReverberation:n.coinUpgrades.barReverberation.valueOf(),barVibration:n.coinUpgrades.barVibration.valueOf(),barAgitation:n.coinUpgrades.barAgitation.valueOf()},talents:{barCriticalChance:n.talents.barCriticalChance.valueOf(),barSpeed:n.talents.barSpeed.valueOf()},barFragments:n.barFragments.valueOf()}),i=btoa(JSON.stringify(r));i!==null&&await pe.default.setItem("UPBSave",i)},sr=new Map([["coins",(n,r)=>{var i,c;return new Ke(Number((c=(i=n.coins)==null?void 0:i.amount)!=null?c:0),r)}],["coinUpgrades.barSpeed",rt],["coinUpgrades.barMomentum",nt],["coinUpgrades.barReverberation",ot],["coinUpgrades.barVibration",at],["coinUpgrades.barAgitation",it],["talents.barCriticalChance",dt],["talents.barSpeed",mt],["barFragments",(n,r)=>{var i,c;return new Qe(Number((c=(i=n.barFragments)==null?void 0:i.amount)!=null?c:0),r)}]]),Rn=async()=>{let n=await pe.default.getItem("UPBSave"),r=n?JSON.parse(atob(n)):null;if(r!==null){let i=Object.keys(r);for(let c of i)c in fr&&(sr.has(c)||Object.defineProperty(M,c,{value:r[c]}))}for(let[i,c]of sr)Gt(M,i,c(r!=null?r:M,M))},Te=new Set,pt=new Proxy(setInterval,{apply(n,r,i){let c=n.apply(r,i);return Te.add(c),c}}),Bn=new Proxy(clearInterval,{apply(n,r,i){let c=i[0];return Te.has(c)&&Te.delete(c),n.apply(r,i)}});window.addEventListener("pagehide",()=>{window.scrollTo(0,0)});var ht=0,lt=24,An=5e3,vt=async()=>{for(let n of Te)Bn(n);Te.clear(),await Rn(),M.barTNL=Ee(M),Object.defineProperty(window,"player",{value:M}),de(le(M.barEXP,M.barTNL)),M.barFragments.updateHTML(),ce("Main"),D("progression",{backgroundColor:ue(M)}),P("coinWorth",{textContent:`Worth ${x(ae(M))} coins`}),ht=performance.now(),pt(Nn,1e3/lt),pt(Zt,1e3,M),pt(In,An,M)},cr=async()=>{if(await _e("Are you SURE you want to reset the game?")===!1)return q("OK, the game hasn't been reset!");await pe.default.removeItem("UPBSave");let r=btoa(JSON.stringify(fr));await pe.default.setItem("UPBSave",r),await vt()},Nn=()=>{let r=performance.now()-ht;Dn(r/1e3),ht+=r},Dn=n=>{Qt(n,M),M.refreshTime+=n,P("refresh-timer",{textContent:`${x(M.refreshTime,2)}s`});let r=le(M.barEXP,M.barTNL);r<100?de(r):Jt(M),qt(M)},xe=60;var ur=n=>{U("main-tab-nav").addEventListener("click",()=>ce("Main")),U("upgrade-tab-nav").addEventListener("click",()=>ce("Upgrades")),U("talent-tab-nav").addEventListener("click",()=>ce("Talents")),U("buy-coin-bar-speed").addEventListener("click",r=>n.coinUpgrades.barSpeed.purchaseLevels(1,r)),U("buy-coin-bar-momentum").addEventListener("click",r=>n.coinUpgrades.barMomentum.purchaseLevels(1,r)),U("buy-coin-bar-reverberation").addEventListener("click",r=>n.coinUpgrades.barReverberation.purchaseLevels(1,r)),U("buy-coin-bar-vibration").addEventListener("click",r=>n.coinUpgrades.barVibration.purchaseLevels(1,r)),U("buy-coin-bar-agitation").addEventListener("click",r=>n.coinUpgrades.barAgitation.purchaseLevels(1,r)),U("buy-reset").addEventListener("click",()=>Be("Refresh",n)),U("reset-game").addEventListener("click",()=>void cr()),U("talentCriticalChanceSacrifice").addEventListener("click",()=>void n.talents.barCriticalChance.sacrificeFragments()),U("talentProgressSpeedSacrifice").addEventListener("click",()=>void n.talents.barSpeed.sacrificeFragments())};window.addEventListener("load",async()=>{var n,r;if(ur(M),await vt(),Ie(M),typeof((n=navigator.storage)==null?void 0:n.persist)=="function"&&typeof((r=navigator.storage)==null?void 0:r.persisted)=="function"){let i=await navigator.storage.persisted();i?console.log(`Storage is persistent! (persistent = ${i})`):await navigator.storage.persist()&&q("Data on this page is now persistent! If you do not know what this means, you can safely ignore it.")}});document.addEventListener("visibilitychange",()=>{document.visibilityState!=="hidden"&&(M.coins.updateHTML(),M.coinUpgrades.barMomentum.updateHTML(),M.coinUpgrades.barSpeed.updateHTML(),M.coinUpgrades.barReverberation.updateHTML(),M.coinUpgrades.barVibration.updateHTML(),M.coinUpgrades.barAgitation.updateHTML(),M.barFragments.updateHTML(),M.talents.barCriticalChance.updateHTML("Initialize"),M.talents.barSpeed.updateHTML("Initialize"),P("coinWorth",{textContent:`Worth ${x(ae(M))} coins`}))});})();
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
//# sourceMappingURL=out.js.map
